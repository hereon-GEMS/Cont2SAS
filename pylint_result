************* Module simu_detector_gen
detector_geometry/SANS-1_MLZ/simu_detector_gen.py:125:13: E1101: Module 'h5py' has no 'File' member (no-member)
************* Module figure_sas
joss_submission/figures/figure_sas.py:25:0: E0401: Unable to import 'pdf2image' (import-error)
************* Module figure_sig_eff
joss_submission/figures/figure_sig_eff.py:25:0: E0401: Unable to import 'pdf2image' (import-error)
************* Module lib.simulation
lib/simulation.py:27:0: E0611: No name 'erf' in module 'scipy.special' (no-name-in-module)
lib/simulation.py:71:9: E1101: Module 'h5py' has no 'File' member (no-member)
************* Module lib.struct_gen
lib/struct_gen.py:194:9: E1101: Module 'h5py' has no 'File' member (no-member)
lib/struct_gen.py:206:9: E1101: Module 'h5py' has no 'File' member (no-member)
************* Module models.ball.ball_plot
models/ball/ball_plot.py:213:23: E1101: Module 'h5py' has no 'File' member (no-member)
models/ball/ball_plot.py:368:12: E1101: Module 'h5py' has no 'File' member (no-member)
************* Module bib_plot
models/bib/bib_plot.py:259:23: E1101: Module 'h5py' has no 'File' member (no-member)
models/bib/bib_plot.py:412:12: E1101: Module 'h5py' has no 'File' member (no-member)
************* Module bib_ecc_plot
models/bib_ecc/bib_ecc_plot.py:276:23: E1101: Module 'h5py' has no 'File' member (no-member)
models/bib_ecc/bib_ecc_plot.py:429:12: E1101: Module 'h5py' has no 'File' member (no-member)
************* Module models.box.box_plot
models/box/box_plot.py:232:23: E1101: Module 'h5py' has no 'File' member (no-member)
models/box/box_plot.py:386:12: E1101: Module 'h5py' has no 'File' member (no-member)
************* Module fs_plot
models/fs/fs_plot.py:249:23: E1101: Module 'h5py' has no 'File' member (no-member)
models/fs/fs_plot.py:403:12: E1101: Module 'h5py' has no 'File' member (no-member)
************* Module models.gg.gg_plot
models/gg/gg_plot.py:239:23: E1101: Module 'h5py' has no 'File' member (no-member)
models/gg/gg_plot.py:394:12: E1101: Module 'h5py' has no 'File' member (no-member)
************* Module phase_field_gen
models/phase_field/phase_field_gen.py:76:14: E1101: Module 'h5py' has no 'File' member (no-member)
************* Module phase_field_plot
models/phase_field/phase_field_plot.py:85:14: E1101: Module 'h5py' has no 'File' member (no-member)
models/phase_field/phase_field_plot.py:211:27: E1101: Module 'h5py' has no 'File' member (no-member)
models/phase_field/phase_field_plot.py:376:16: E1101: Module 'h5py' has no 'File' member (no-member)
************* Module sld_grow_plot
models/sld_grow/sld_grow_plot.py:239:23: E1101: Module 'h5py' has no 'File' member (no-member)
models/sld_grow/sld_grow_plot.py:390:12: E1101: Module 'h5py' has no 'File' member (no-member)
models/sld_grow/sld_grow_plot.py:506:13: E1101: Module 'h5py' has no 'File' member (no-member)
************* Module sld_grow_plot_joss
models/sld_grow/sld_grow_plot_joss.py:228:12: E1101: Module 'h5py' has no 'File' member (no-member)
models/sld_grow/sld_grow_plot_joss.py:295:13: E1101: Module 'h5py' has no 'File' member (no-member)
************* Module moose_read.exodus_reader
moose_read/exodus_reader.py:27:0: E0401: Unable to import 'netCDF4' (import-error)
moose_read/exodus_reader.py:212:9: E1101: Module 'h5py' has no 'File' member (no-member)
************* Module scatt_cal
src/scatt_cal.py:199:17: E1101: Module 'h5py' has no 'File' member (no-member)
src/scatt_cal.py:224:23: E1101: Module 'h5py' has no 'File' member (no-member)
src/scatt_cal.py:278:17: E1101: Module 'h5py' has no 'File' member (no-member)
src/scatt_cal.py:307:12: E1101: Module 'h5py' has no 'File' member (no-member)
************* Module sig_eff_cal
src/sig_eff_cal.py:198:19: E1101: Module 'h5py' has no 'File' member (no-member)
src/sig_eff_cal.py:224:12: E1101: Module 'h5py' has no 'File' member (no-member)
src/sig_eff_cal.py:304:13: E1101: Module 'h5py' has no 'File' member (no-member)
************* Module sim_gen
src/sim_gen.py:31:0: E0401: Unable to import 'imageio.v2' (import-error)
src/sim_gen.py:246:17: E1101: Module 'h5py' has no 'File' member (no-member)
************* Module test_sld_grow
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==fs_plot:[286:410]
==models.gg.gg_plot:[276:400]
            img = ax.imshow(node_sld_3d[:,:,z_idx].T,
                             extent=[0, length_a, 0, length_b],
                               origin='lower', vmin=sld_min, vmax=sld_max, interpolation='bilinear')

            ## color bar
            cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
            cbar_label=r"Scattering length density (SLD) [$10^{-5} \cdot \mathrm{\AA}^{-2}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title
            title_text=" Cut at Z = {0} {1}".format(z_val, r"$\mathrm{\AA}$")
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            ## add mesh
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))

            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

            # plotting pseudo atoms
            ## cutting at z = z_val + length_z
            # cell_z= length_c/nz
            # z_val_pseudo=z_val+cell_z
            cut_frac=0.5
            pseudo_pos_3d=pseudo_pos.reshape((nx, ny, nz, 3))
            pseudo_b_3d=pseudo_b.reshape((nx, ny, nz))
            z_idx_pseudo= nz//2-1
            z_val_pseudo=pseudo_pos_3d[0, 0, z_idx_pseudo , 2]
            ## figure specification
            plot_file_name=f'pseudo_{sim_model}_{t_str}.pdf'
            plot_file=os.path.join(plot_dir,plot_file_name)
            fig, ax = plt.subplots(figsize=(5, 5))
            ## scatter plot
            pseudo_pos_x=pseudo_pos_3d[:,:,z_idx_pseudo,0]
            pseudo_pos_y=pseudo_pos_3d[:,:,z_idx_pseudo,1]
            pseudo_b_xy=pseudo_b_3d[:,:,z_idx_pseudo]
            img = ax.scatter(pseudo_pos_x, pseudo_pos_y, c=pseudo_b_xy, s=3, cmap='viridis')
            ## color bar
            cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
            cbar_label=r"Scattering length (b) [$10^{-5} \cdot \mathrm{\AA} = \mathrm{fm}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title
            title_text=" Cut at Z = {0} {1}".format(z_val_pseudo, r"$\mathrm{\AA}$")
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            # other formatting
            ax.set_aspect('equal')
            ax.set_xlim([0, length_a])
            ax.set_ylim([0, length_b])
            ## add mesh
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))
            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

            # plotting categorized pseudo atoms
            ## figure specification
            plot_file_name=f'pseudo_cat_{sim_model}_{t_str}.pdf'
            plot_file=os.path.join(plot_dir,plot_file_name)
            fig, ax = plt.subplots(figsize=(5, 5))
            ## scatter plot
            pseudo_b_cat_val_3d=pseudo_b_cat_val.reshape((nx, ny, nz))
            pseudo_b_cat_val_xy=pseudo_b_cat_val_3d[:,:,z_idx_pseudo]
            img = ax.scatter(pseudo_pos_x, pseudo_pos_y, c=pseudo_b_cat_val_xy, s=3, cmap='viridis')
            ## color bar
            cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
            cbar_label=r"Scattering length (b) [$10^{-5} \cdot \mathrm{\AA} = \mathrm{fm}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title
            title_text=" Cut at Z = {0} {1}".format(z_val_pseudo, r"$\mathrm{\AA}$")
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            # other formatting
            ax.set_aspect('equal')
            ax.set_xlim([0, length_a])
            ax.set_ylim([0, length_b])
            x_ticks_val=np.round(np.linspace(0, length_a, 5),2)
            ax.set_xticks(list(x_ticks_val))
            y_ticks_val=np.round(np.linspace(0, length_b, 5),2)
            ax.set_yticks(list(y_ticks_val))
            ## add mesh
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))
            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

    # volume for normalization
    vol_norm=length_a*length_b*length_c # volume of box

    # numerical intensity
    ## read I vs Q signal file
    Iq_data_file_name=f'Iq_{scatt_settings}.h5'
    Iq_data_file=os.path.join(t_dir,Iq_data_file_name)
    Iq_data=h5py.File(Iq_data_file,'r')
    Iq_num_raw=Iq_data['Iq'][:] # unit fm^2
    Iq_num=Iq_num_raw/vol_norm*10**2 # unit (fm^2 / \AA^3) * 10^2 = cm^-1
    q_num=Iq_data['Q'][:]
    Iq_data.close()

    # fit radius w.r.t. numerical intensity (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==sld_grow_plot:[35:198]
==sld_grow_plot_joss:[33:196]
lib_dir = os.path.abspath(os.path.join(os.path.dirname(__file__), '../..'))
# add .. in path
sys.path.append(lib_dir)
# lib imports here (if necessary)

# ignore warnings
warnings.filterwarnings("ignore")

# analytical SAS function
def J1(x):
    """
    function desc:
    spherical bessel function
    """
    # special case
    if x==0:
        return 0
    # general case
    return (np.sin(x)-x*np.cos(x))/x**2

def ball (qmax,qmin,Npts,scale,bg,sld,sld_sol,rad):
    """
    function desc:
    analytical SAS pattern of sphere
    """
    vol=(4/3)*np.pi*rad**3
    # SLD unit 10^-5 \AA^-2
    del_rho=sld-sld_sol
    q_arr=np.linspace(qmin,qmax,Npts)
    FormFactor=np.zeros(len(q_arr))
    for q_idx, q in enumerate(q_arr):
        if q==0:
            # Form factor unit 10^-5 \AA
            FormFactor[q_idx]=vol*del_rho
        else:
            # Form factor unit 10^-5 \AA
            FormFactor[q_idx]=3*vol*del_rho*J1(q*rad)/(q*rad)
    # Intensity unit 10^-10 \AA^2
    Iq_arr = (scale)*np.abs(FormFactor)**2+bg
    return Iq_arr, q_arr

def fit_func_sld_grow(q_in, sld_opt):
    """
    function desc:
    fit function
    """
    # pylint: disable=unused-variable
    Iq, q_out =ball(qmax=max(q_in),qmin=min(q_in),
                        Npts=len(q_in), scale=1 , bg=0,
                        sld=sld_opt, sld_sol=0,
                        rad=rad_grain)
    return Iq

############
# Input data
############
### file locations ###
# xml location
xml_folder='./xml/'
# script dir and working dir
script_dir = "src"  # Full path of the script
working_dir = "."  # Directory to run the script in


### struct gen ###
# box side lengths (float values)
length_a=40.
length_b=length_a
length_c=length_a
# number of cells in each direction (int values)
nx=40
ny=nx
nz=nx
# element details
el_type='lagrangian'
el_order=1
# calculate mid point of structure (simulation box)
mid_point=np.array([length_a/2, length_b/2, length_c/2])


### sim gen ###
# model name
sim_model='sld_grow'
# simulation parameters
dt=1.
t_end=10.
n_ensem=1
# calculate time array
t_arr=np.arange(0,t_end+dt, dt)

### model param ###
# model params
rad_grain=10
sld_in_0=2
sld_in_end=5
sld_out=1
qclean_sld=sld_out
# dir name for model param
model_param_dir_name = ('rad' + '_' + str(rad_grain) + '_' +
                        'sld_in_0' + '_' + str(sld_in_0) + '_' +
                        'sld_in_end' + '_' + str(sld_in_end) + '_' +
                        'sld_out' + '_' + str(sld_out)+ '_' +
                        'qclean_sld' + '_' + str(qclean_sld)
                        ).replace('.', 'p')


### scatt_cal ###
num_cat=101 # also check with 3
method_cat='extend'
sig_file='signal.h5'
scan_vec=np.array([1, 0, 0])
# these values are taken from publication
# doi: https://doi.org/10.3233/JNR-190116
Q_range=np.array([0.0029, 0.05])
num_points=100
num_orientation=10
# scatt settengs
scatt_settings='cat_' + method_cat + '_' + str(num_cat) + 'Q_' \
    + str(Q_range[0]) + '_' + str(Q_range[1]) + '_' + 'orien__' + str(num_orientation)
scatt_settings=scatt_settings.replace('.', 'p')

"""
read folder structure
"""
# folder structure
## mother folder name
### save length values as strings
### decimal points are replaced with p
length_a_str=str(length_a).replace('.','p')
length_b_str=str(length_a).replace('.','p')
length_c_str=str(length_a).replace('.','p')

### save num_cell values as strings
nx_str=str(nx)
ny_str=str(ny)
nz_str=str(nz)

### save element_order values as strings
el_order_str='lagrangian_' + str(el_order)

mother_dir_name = length_a_str+'_' + length_b_str+'_' + length_c_str\
      + '_' + nx_str + '_' + ny_str + '_' + nz_str + '_' + el_order_str
data_dir=os.path.join(working_dir, 'data')
mother_dir = os.path.join(data_dir, mother_dir_name)

# read structure info
data_file=os.path.join(mother_dir, 'structure/struct.h5')

# folder name for simulation
sim_dir=os.path.join(mother_dir, 'simulation')

# folder name for model
model_dir_name= (sim_model + '_tend_' + str(t_end) + '_dt_' + str(dt) \
    + '_ensem_' + str(n_ensem)).replace('.','p')
model_dir=os.path.join(sim_dir,model_dir_name)

# folder name for model with particular run param
model_param_dir=os.path.join(model_dir,model_param_dir_name)

# create folder for figure (one level up from data folder)
figure_dir=os.path.join(mother_dir, '../../figure/')
os.makedirs(figure_dir, exist_ok=True)
## folder for this suit of figures (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_plot:[199:301]
==models.box.box_plot:[154:258]
scatt_settings='cat_' + method_cat + '_' + str(num_cat) + 'Q_' \
    + str(Q_range[0]) + '_' + str(Q_range[1]) + '_' + 'orien__' + str(num_orientation)
scatt_settings=scatt_settings.replace('.', 'p')

#######################
# read folder structure
#######################

# folder structure
## mother folder name
### save length values as strings
### decimal points are replaced with p
length_a_str=str(length_a).replace('.','p')
length_b_str=str(length_a).replace('.','p')
length_c_str=str(length_a).replace('.','p')

### save num_cell values as strings
nx_str=str(nx)
ny_str=str(ny)
nz_str=str(nz)

### save element_order values as strings
el_order_str='lagrangian_' + str(el_order)

mother_dir_name = length_a_str+'_' + length_b_str+'_' + length_c_str\
      + '_' + nx_str + '_' + ny_str + '_' + nz_str + '_' + el_order_str
data_dir=os.path.join(working_dir, 'data')
mother_dir = os.path.join(data_dir, mother_dir_name)

# read structure info
data_file=os.path.join(mother_dir, 'structure/struct.h5')

# folder name for simulation
sim_dir=os.path.join(mother_dir, 'simulation')

### model xml entries ###
# folder name for model
model_dir_name= (sim_model + '_tend_' + str(t_end) + '_dt_' + str(dt) \
    + '_ensem_' + str(n_ensem)).replace('.','p')
model_dir=os.path.join(sim_dir,model_dir_name)

# folder name for model with particular run param
model_param_dir=os.path.join(model_dir,model_param_dir_name)

# create folder for figure (one level up from data folder)
figure_dir=os.path.join(mother_dir, '../../figure/')
os.makedirs(figure_dir, exist_ok=True)
## folder for this suit of figures
plot_dir=os.path.join(figure_dir, sim_model)
os.makedirs(plot_dir, exist_ok=True)

# for i in range(len(t_arr)):
for i, t in enumerate(t_arr):
    # time_dir name
    t_dir_name=f't{i:0>3}'
    t_dir=os.path.join(model_param_dir, t_dir_name)
    for j in range(n_ensem):
        idx_ensem=j
        # create ensemble dir
        ensem_dir_name=f'ensem{idx_ensem:0>3}'
        ensem_dir=os.path.join(t_dir, ensem_dir_name)

        # create scatt dir
        scatt_dir_name='scatt_cal_'+ scatt_settings
        scatt_dir=os.path.join(ensem_dir, scatt_dir_name)


        #########################################
        # read pseudo atom info from scatt_cal.h5
        #########################################

        # read node sld
        # save pseudo atom info
        scatt_cal_dir_name='scatt_cal_' + scatt_settings
        scatt_cal_dir=os.path.join(ensem_dir, scatt_cal_dir_name)
        scatt_cal_data_file_name='scatt_cal.h5'
        scatt_cal_data_file=os.path.join(scatt_cal_dir, scatt_cal_data_file_name)
        scatt_cal_data=h5py.File(scatt_cal_data_file,'r')
        node_pos=scatt_cal_data['node_pos'][:]
        node_pos=np.array(node_pos)
        node_sld=scatt_cal_data['node_sld'][:]
        node_sld=np.array(node_sld)
        pseudo_pos=scatt_cal_data['pseudo_pos'][:]
        pseudo_pos=np.array(pseudo_pos)
        pseudo_b=scatt_cal_data['pseudo_b'][:]
        pseudo_b=np.array(pseudo_b)
        pseudo_b_cat_val=scatt_cal_data['pseudo_b_cat_val'][:]
        pseudo_b_cat_val=np.array(pseudo_b_cat_val)
        pseudo_b_cat_idx=scatt_cal_data['pseudo_b_cat_idx'][:]
        scatt_cal_data.close()

        # determine sld min and max for plotting
        sld_min=np.min(node_sld,0)
        sld_max=np.max(node_sld,0)


        if idx_ensem==0:
            if el_type=='lagrangian':
                num_node_x=el_order*nx+1
                num_node_y=el_order*ny+1
                num_node_z=el_order*nz+1
            # plotting node SLD
            ## cutting at z = cut_frac * length_z
            cut_frac=0.5 (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_plot:[225:302]
==phase_field_plot:[161:238]
data_dir=os.path.join(working_dir, 'data')
mother_dir = os.path.join(data_dir, mother_dir_name)

# read structure info
data_file=os.path.join(mother_dir, 'structure/struct.h5')

# folder name for simulation
sim_dir=os.path.join(mother_dir, 'simulation')

### model xml entries ###
# folder name for model
model_dir_name= (sim_model + '_tend_' + str(t_end) + '_dt_' + str(dt) \
    + '_ensem_' + str(n_ensem)).replace('.','p')
model_dir=os.path.join(sim_dir,model_dir_name)

# folder name for model with particular run param
model_param_dir=os.path.join(model_dir,model_param_dir_name)

# create folder for figure (one level up from data folder)
figure_dir=os.path.join(mother_dir, '../../figure/')
os.makedirs(figure_dir, exist_ok=True)
## folder for this suit of figures
plot_dir=os.path.join(figure_dir, sim_model)
os.makedirs(plot_dir, exist_ok=True)

for i, t in enumerate(t_arr):
    # time_dir name
    t_dir_name=f't{i:0>3}'
    t_dir=os.path.join(model_param_dir, t_dir_name)
    for j in range(n_ensem):
        idx_ensem=j
        # create ensemble dir
        ensem_dir_name=f'ensem{idx_ensem:0>3}'
        ensem_dir=os.path.join(t_dir, ensem_dir_name)

        # create scatt dir
        scatt_dir_name='scatt_cal_'+ scatt_settings
        scatt_dir=os.path.join(ensem_dir, scatt_dir_name)


        #########################################
        # read pseudo atom info from scatt_cal.h5
        #########################################

        # read node sld
        # save pseudo atom info
        scatt_cal_dir_name='scatt_cal_' + scatt_settings
        scatt_cal_dir=os.path.join(ensem_dir, scatt_cal_dir_name)
        scatt_cal_data_file_name='scatt_cal.h5'
        scatt_cal_data_file=os.path.join(scatt_cal_dir, scatt_cal_data_file_name)
        scatt_cal_data=h5py.File(scatt_cal_data_file,'r')
        node_pos=scatt_cal_data['node_pos'][:]
        node_pos=np.array(node_pos)
        node_sld=scatt_cal_data['node_sld'][:]
        node_sld=np.array(node_sld)
        pseudo_pos=scatt_cal_data['pseudo_pos'][:]
        pseudo_pos=np.array(pseudo_pos)
        pseudo_b=scatt_cal_data['pseudo_b'][:]
        pseudo_b=np.array(pseudo_b)
        pseudo_b_cat_val=scatt_cal_data['pseudo_b_cat_val'][:]
        pseudo_b_cat_val=np.array(pseudo_b_cat_val)
        pseudo_b_cat_idx=scatt_cal_data['pseudo_b_cat_idx'][:]
        scatt_cal_data.close()

        # determine sld min and max for plotting
        sld_min=np.min(node_sld,0)
        sld_max=np.max(node_sld,0)

        if idx_ensem==0:
            if el_type=='lagrangian':
                num_node_x=el_order*nx+1
                num_node_y=el_order*ny+1
                num_node_z=el_order*nz+1
            # plotting node SLD
            ## cutting at z = cut_frac * length_z
            cut_frac=0.5
            node_pos_3d=node_pos.reshape((num_node_x, num_node_y, num_node_z, 3)) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.box.box_plot:[180:258]
==phase_field_plot:[161:237]
    data_dir=os.path.join(working_dir, 'data')
    mother_dir = os.path.join(data_dir, mother_dir_name)

    # read structure info
    data_file=os.path.join(mother_dir, 'structure/struct.h5')

    # folder name for simulation
    sim_dir=os.path.join(mother_dir, 'simulation')

    # folder name for model
    model_dir_name= (sim_model + '_tend_' + str(t_end) + '_dt_' + str(dt) \
        + '_ensem_' + str(n_ensem)).replace('.','p')
    model_dir=os.path.join(sim_dir,model_dir_name)

    # folder name for model with particular run param
    model_param_dir=os.path.join(model_dir,model_param_dir_name)

    # create folder for figure (one level up from data folder)
    figure_dir=os.path.join(mother_dir, '../../figure/')
    os.makedirs(figure_dir, exist_ok=True)
    ## folder for this suit of figures
    plot_dir=os.path.join(figure_dir, sim_model)
    os.makedirs(plot_dir, exist_ok=True)

    for i, t in enumerate(t_arr):
        # time_dir name
        t_dir_name=f't{i:0>3}'
        t_dir=os.path.join(model_param_dir, t_dir_name)

        for j in range(n_ensem):
            idx_ensem=j
            # create ensemble dir
            ensem_dir_name=f'ensem{idx_ensem:0>3}'
            ensem_dir=os.path.join(t_dir, ensem_dir_name)

            # create scatt dir
            scatt_dir_name='scatt_cal_'+ scatt_settings
            scatt_dir=os.path.join(ensem_dir, scatt_dir_name)


            """
            read pseudo atom info from scatt_cal.h5
            """
            # read node sld
            # save pseudo atom info
            scatt_cal_dir_name='scatt_cal_' + scatt_settings
            scatt_cal_dir=os.path.join(ensem_dir, scatt_cal_dir_name)
            scatt_cal_data_file_name='scatt_cal.h5'
            scatt_cal_data_file=os.path.join(scatt_cal_dir, scatt_cal_data_file_name)
            scatt_cal_data=h5py.File(scatt_cal_data_file,'r')
            node_pos=scatt_cal_data['node_pos'][:]
            node_pos=np.array(node_pos)
            node_sld=scatt_cal_data['node_sld'][:]
            node_sld=np.array(node_sld)
            pseudo_pos=scatt_cal_data['pseudo_pos'][:]
            pseudo_pos=np.array(pseudo_pos)
            pseudo_b=scatt_cal_data['pseudo_b'][:]
            pseudo_b=np.array(pseudo_b)
            pseudo_b_cat_val=scatt_cal_data['pseudo_b_cat_val'][:]
            pseudo_b_cat_val=np.array(pseudo_b_cat_val)
            pseudo_b_cat_idx=scatt_cal_data['pseudo_b_cat_idx'][:]
            scatt_cal_data.close()

            # determine sld min and max for plotting
            sld_min=np.min(node_sld,0)
            sld_max=np.max(node_sld,0)


            if idx_ensem==0:
                if el_type=='lagrangian':
                    num_node_x=el_order*nx+1
                    num_node_y=el_order*ny+1
                    num_node_z=el_order*nz+1
                # plotting node SLD
                ## cutting at z = cut_frac * length_z
                cut_frac=0.5 (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.ball.ball_gen:[76:136]
==models.gg.gg_gen:[78:138]
num_cat=3
method_cat='extend'
sassena_exe= './Sassena/Sassena.AppImage'
mpi_procs=1
num_threads=1
sig_file='signal.h5'
scan_vec=np.array([1, 0, 0])
Q_range=np.array([0., 1.])
num_points=100
num_orientation=10

### run vars ###
struct_gen_run=1
sim_run=1
scatt_cal_run=1

"""
xml gen and run scripts
"""
part_str='Part>>>  '
info_str='Info>>>  '

print('-------------------------------------------------')
print(part_str + 'Generating mesh')
print('')
# time counter start - struct gen
tic_sg = time.perf_counter()
if struct_gen_run==1:
    # generate xml for struct_gen
    print(info_str + 'Generating struct_gen.xml')
    xml_gen.struct_xml_write(xml_dir,
                              length_a, length_b, length_c,
                                nx, ny, nz,
                                  el_type, el_order,
                                    update_val, plt_node, plt_cell, plt_mesh)

    # generate structure
    print(info_str + 'Executing struct_gen.py')
    script_path = os.path.join(script_dir, 'struct_gen.py')  # Full path of the script
    #working_dir = "."  # Directory to run the script in
    subprocess.run(["python", script_path], cwd=working_dir, stderr=subprocess.PIPE, check=True)
else:
    print(info_str + 'structure generation not attempted')
# time counter end - struct gen
toc_sg = time.perf_counter()
ttot_sg= round(toc_sg - tic_sg,3)
print(f'Time taken for generating mesh: {ttot_sg} s')
print('-------------------------------------------------')

print('-------------------------------------------------')
print(part_str + 'Assigning SLD values to nodes')
print('')
# time counter start - simulation gen
tic_sim = time.perf_counter()
if sim_run==1:
    # simulation xml
    print(info_str + 'Generating simulation.xml')
    xml_gen.sim_xml_write(xml_dir, sim_model,dt, t_end, n_ensem)

    # model xml (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==sld_grow_plot:[478:536]
==sld_grow_plot_joss:[267:325]
plot_file_name=f'Iq_{sim_model}.pdf'
plot_file=os.path.join(plot_dir,plot_file_name)
fig_scatt_all.savefig(plot_file, format='pdf')
plt.close('all')

# plot fit param for all time step
plot_file_name=f'sld_fit_{sim_model}.pdf'
plot_file=os.path.join(plot_dir,plot_file_name)
fig, ax = plt.subplots(figsize=(7, 5))

ax.plot(t_arr, sld_ana, 'b', label= 'Simulation value')
ax.plot(t_arr, sld_fit, 'r', linestyle='', marker='^', markersize=5, label= 'Fit value')

# plot formatting
## legend
ax.legend()
## labels
ax.set_xlabel('Time [s]')
ax.set_ylabel(r'SLD of grain [$10^{-5} \cdot \mathrm{\AA}^{-2}$]')
## limits
ax.grid(True)
## save plot
plt.savefig(plot_file, format='pdf')
plt.close(fig)

sig_eff_data_file_name=f'sig_eff_{scatt_settings}.h5'
sig_eff_data_file=os.path.join(model_param_dir, sig_eff_data_file_name)
sig_eff_data=h5py.File(sig_eff_data_file,'r')
sig_eff_num=sig_eff_data['sig_eff'][:]
sig_eff_t=sig_eff_data['t'][:]
sig_eff_data.close()

contrast_arr = sld_fit-sld_out
factor=sig_eff_num[0]/(contrast_arr[0]**2)

# plot fit param for all time step
plot_file_name=f'sig_eff_fit_{sim_model}.pdf'
plot_file=os.path.join(plot_dir,plot_file_name)
fig, ax = plt.subplots(figsize=(7, 5))

ax.plot(sig_eff_t, sig_eff_num, 'b',
         label= 'Simulation value')
ax.plot(sig_eff_t, factor*contrast_arr**2, 'r',
         linestyle='',
           marker='^', markersize=5,
             label= 'Fit value')

# plot formatting
## legend
ax.legend()
## labels
ax.set_xlabel('Time [s]')
ax.set_ylabel(r'Effective cross-section [$10^{-5} \cdot \mathrm{\AA}^{-2}$]')
## limits
ax.grid(True)
## save plot
plt.savefig(plot_file, format='pdf')
plt.close(fig) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==fs_gen:[144:192]
==models.gg.gg_gen:[142:190]
    print(info_str + 'Executing sim_gen.py')
    script_path = os.path.join(script_dir, 'sim_gen.py')  # Full path of the script
    #working_dir = "."  # Directory to run the script in
    subprocess.run(["python", script_path], cwd=working_dir, stderr=subprocess.PIPE, check=True)
else:
    print(info_str + 'simulation not attempted')
# time counter end - simulation gen
toc_sim = time.perf_counter()
ttot_sim= round(toc_sim - tic_sim,3)
print(f'Time taken for assigning SLD values: {ttot_sim} s')
print('-------------------------------------------------')

print('-------------------------------------------------')
print(part_str + 'Calculating SAS pattern')
print('')
# time counter start - SAS calculation
tic_scatt = time.perf_counter()
if scatt_cal_run==1:
    # scatt_cal xml
    print(info_str + 'Generating scatt_cal.xml')
    xml_gen.scatt_cal_xml_write(xml_dir, num_cat, method_cat,
                                sassena_exe, mpi_procs, num_threads,
                                sig_file, scan_vec, Q_range,
                                num_points, num_orientation)

    # calculate scattering function
    print(info_str + 'Executing scatt_cal.py')
    script_path = os.path.join(script_dir, 'scatt_cal.py')  # Full path of the script
    #working_dir = "."  # Directory to run the script in
    subprocess.run(["python", script_path], cwd=working_dir, stderr=subprocess.PIPE, check=True)
else:
    print(info_str + 'Calculation of scattring function not attempted')
# time counter end - SAS calculation
toc_scatt = time.perf_counter()
ttot_scatt= round(toc_scatt - tic_scatt,3)
print(f'Time taken for calculating SAS pattern: {ttot_scatt} s')
print('-------------------------------------------------')

# Time satistics
print('')
print('-------------------------------------------------')
print('Time statistics')
print('-------------------------------------------------')
print(f'Mesh generation :{ttot_sg} s')
print(f'SLD assign      :{ttot_sim} s')
print(f'SAS calculation :{ttot_scatt} s')
print(f'Total           :{ttot_sg + ttot_sim + ttot_scatt} s')
print('-------------------------------------------------') (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_gen:[143:192]
==models.box.box_gen:[138:187]
    print(info_str + 'Executing sim_gen.py')
    script_path = os.path.join(script_dir, 'sim_gen.py')  # Full path of the script
    #working_dir = "."  # Directory to run the script in
    subprocess.run(["python", script_path], cwd=working_dir, stderr=subprocess.PIPE, check=True)
else:
    print(info_str + 'simulation not attempted')
# time counter end - simulation gen
toc_sim = time.perf_counter()
ttot_sim= round(toc_sim - tic_sim,3)
print(f'Time taken for assigning SLD values: {ttot_sim} s')
print('-------------------------------------------------')

print('-------------------------------------------------')
print(part_str + 'Calculating SAS pattern')
print('')
# time counter start - SAS calculation
tic_scatt = time.perf_counter()
if scatt_cal_run==1:
    # scatt_cal xml
    print(info_str + 'Generating scatt_cal.xml')
    xml_gen.scatt_cal_xml_write(xml_dir, num_cat, method_cat,
                                sassena_exe, mpi_procs, num_threads,
                                sig_file, scan_vec, Q_range,
                                num_points, num_orientation)

    # calculate scattering function
    print(info_str + 'Executing scatt_cal.py')
    script_path = os.path.join(script_dir, 'scatt_cal.py')  # Full path of the script
    #working_dir = "."  # Directory to run the script in
    subprocess.run(["python", script_path], cwd=working_dir, stderr=subprocess.PIPE, check=True)
else:
    print(info_str + 'Calculation of scattring function not attempted')
# time counter end - SAS calculation
toc_scatt = time.perf_counter()
ttot_scatt= round(toc_scatt - tic_scatt,3)
print(f'Time taken for calculating SAS pattern: {ttot_scatt} s')
print('-------------------------------------------------')


# Time satistics
print('')
print('-------------------------------------------------')
print('Time statistics')
print('-------------------------------------------------')
print(f'Mesh generation :{ttot_sg} s')
print(f'SLD assign      :{ttot_sim} s')
print(f'SAS calculation :{ttot_scatt} s')
print(f'Total           :{ttot_sg + ttot_sim + ttot_scatt} s')
print('-------------------------------------------------') (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_gen:[142:191]
==models.ball.ball_gen:[140:188]
    print(info_str + 'Executing sim_gen.py')
    script_path = os.path.join(script_dir, 'sim_gen.py')  # Full path of the script
    #working_dir = "."  # Directory to run the script in
    subprocess.run(["python", script_path], cwd=working_dir, stderr=subprocess.PIPE, check=True)
else:
    print(info_str + 'simulation not attempted')
# time counter end - simulation gen
toc_sim = time.perf_counter()
ttot_sim= round(toc_sim - tic_sim,3)
print(f'Time taken for assigning SLD values: {ttot_sim} s')
print('-------------------------------------------------')

print('-------------------------------------------------')
print(part_str + 'Calculating SAS pattern')
print('')
# time counter start - SAS calculation
tic_scatt = time.perf_counter()
if scatt_cal_run==1:
    # scatt_cal xml
    print(info_str + 'Generating scatt_cal.xml')
    xml_gen.scatt_cal_xml_write(xml_dir, num_cat, method_cat,
                                sassena_exe, mpi_procs, num_threads,
                                sig_file, scan_vec, Q_range,
                                num_points, num_orientation)

    # calculate scattering function
    print(info_str + 'Executing scatt_cal.py')
    script_path = os.path.join(script_dir, 'scatt_cal.py')  # Full path of the script
    #working_dir = "."  # Directory to run the script in
    subprocess.run(["python", script_path], cwd=working_dir, stderr=subprocess.PIPE, check=True)
else:
    print(info_str + 'Calculation of scattring function not attempted')
# time counter end - SAS calculation
toc_scatt = time.perf_counter()
ttot_scatt= round(toc_scatt - tic_scatt,3)
print(f'Time taken for calculating SAS pattern: {ttot_scatt} s')
print('-------------------------------------------------')


# Time satistics
print('')
print('-------------------------------------------------')
print('Time statistics')
print('-------------------------------------------------')
print(f'Mesh generation :{ttot_sg} s')
print(f'SLD assign      :{ttot_sim} s')
print(f'SAS calculation :{ttot_scatt} s')
print(f'Total           :{ttot_sg + ttot_sim + ttot_scatt} s')
print('-------------------------------------------------') (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[169:238]
==models.box.box_plot:[140:210]
                             '_' + 'qclean_sld' + '_' + str(qclean_sld)
                             ).replace('.', 'p')

### scatt cal ###
# decreitization params
# number of categories and method of categorization
num_cat=3
method_cat='extend'
sig_file='signal.h5'
scan_vec=np.array([1, 0, 0])
Q_range=np.array([0., 1.]) # mention integers as float
num_points=100
num_orientation=200
# scatt settengs
scatt_settings='cat_' + method_cat + '_' + str(num_cat) + 'Q_' \
    + str(Q_range[0]) + '_' + str(Q_range[1]) + '_' + 'orien__' + str(num_orientation)
scatt_settings=scatt_settings.replace('.', 'p')

"""
read folder structure
"""

# folder structure
## mother folder name
### save length values as strings
### decimal points are replaced with p
length_a_str=str(length_a).replace('.','p')
length_b_str=str(length_a).replace('.','p')
length_c_str=str(length_a).replace('.','p')

### save num_cell values as strings
nx_str=str(nx)
ny_str=str(ny)
nz_str=str(nz)

### save element_order values as strings
el_order_str='lagrangian_' + str(el_order)

mother_dir_name = length_a_str+'_' + length_b_str+'_' + length_c_str\
      + '_' + nx_str + '_' + ny_str + '_' + nz_str + '_' + el_order_str
data_dir=os.path.join(working_dir, 'data')
mother_dir = os.path.join(data_dir, mother_dir_name)

# read structure info
data_file=os.path.join(mother_dir, 'structure/struct.h5')

# folder name for simulation
sim_dir=os.path.join(mother_dir, 'simulation')

### model xml entries ###
# folder name for model
model_dir_name= (sim_model + '_tend_' + str(t_end) + '_dt_' + str(dt) \
    + '_ensem_' + str(n_ensem)).replace('.','p')
model_dir=os.path.join(sim_dir,model_dir_name)

# folder name for model with particular run param
model_param_dir=os.path.join(model_dir,model_param_dir_name)

# create folder for figure (one level up from data folder)
figure_dir=os.path.join(mother_dir, '../../figure/')
os.makedirs(figure_dir, exist_ok=True)
## folder for this suit of figures
plot_dir=os.path.join(figure_dir, sim_model)
os.makedirs(plot_dir, exist_ok=True)

for i, t in enumerate(t_arr):
    # time_dir name
    t_dir_name=f't{i:0>3}'
    t_dir=os.path.join(model_param_dir, t_dir_name) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.ball.ball_plot:[190:241]
==phase_field_plot:[187:241]
        t_dir_name=f't{i:0>3}'
        t_dir=os.path.join(model_param_dir, t_dir_name)

        for j in range(n_ensem):
            idx_ensem=j
            # create ensemble dir
            ensem_dir_name=f'ensem{idx_ensem:0>3}'
            ensem_dir=os.path.join(t_dir, ensem_dir_name)

            # create scatt dir
            scatt_dir_name='scatt_cal_'+ scatt_settings
            scatt_dir=os.path.join(ensem_dir, scatt_dir_name)


            """
            read pseudo atom info from scatt_cal.h5
            """
            # read node sld
            # save pseudo atom info
            scatt_cal_dir_name='scatt_cal_' + scatt_settings
            scatt_cal_dir=os.path.join(ensem_dir, scatt_cal_dir_name)
            scatt_cal_data_file_name='scatt_cal.h5'
            scatt_cal_data_file=os.path.join(scatt_cal_dir, scatt_cal_data_file_name)
            scatt_cal_data=h5py.File(scatt_cal_data_file,'r')
            node_pos=scatt_cal_data['node_pos'][:]
            node_pos=np.array(node_pos)
            node_sld=scatt_cal_data['node_sld'][:]
            node_sld=np.array(node_sld)
            pseudo_pos=scatt_cal_data['pseudo_pos'][:]
            pseudo_pos=np.array(pseudo_pos)
            pseudo_b=scatt_cal_data['pseudo_b'][:]
            pseudo_b=np.array(pseudo_b)
            pseudo_b_cat_val=scatt_cal_data['pseudo_b_cat_val'][:]
            pseudo_b_cat_val=np.array(pseudo_b_cat_val)
            pseudo_b_cat_idx=scatt_cal_data['pseudo_b_cat_idx'][:]
            scatt_cal_data.close()

            # determine sld min and max for plotting
            sld_min=np.min(node_sld,0)
            sld_max=np.max(node_sld,0)


            if idx_ensem==0:
                if el_type=='lagrangian':
                    num_node_x=el_order*nx+1
                    num_node_y=el_order*ny+1
                    num_node_z=el_order*nz+1
                # plotting node SLD
                ## cutting at z = cut_frac * length_z
                cut_frac=0.5
                node_pos_3d=node_pos.reshape((num_node_x, num_node_y, num_node_z, 3))
                z_idx= np.floor(cut_frac*(num_node_z)).astype(int)
                z_val=node_pos_3d[0, 0, z_idx , 2]
                ## figure specification (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_plot:[254:305]
==models.gg.gg_plot:[219:269]
    for j in range(n_ensem):
        idx_ensem=j
        # create ensemble dir
        ensem_dir_name=f'ensem{idx_ensem:0>3}'
        ensem_dir=os.path.join(t_dir, ensem_dir_name)

        # create scatt dir
        scatt_dir_name='scatt_cal_'+ scatt_settings
        scatt_dir=os.path.join(ensem_dir, scatt_dir_name)

        """
        read pseudo atom info from scatt_cal.h5
        """
        # read node sld
        # save pseudo atom info
        scatt_cal_dir_name='scatt_cal_' + scatt_settings
        scatt_cal_dir=os.path.join(ensem_dir, scatt_cal_dir_name)
        scatt_cal_data_file_name='scatt_cal.h5'
        scatt_cal_data_file=os.path.join(scatt_cal_dir, scatt_cal_data_file_name)
        scatt_cal_data=h5py.File(scatt_cal_data_file,'r')
        node_pos=scatt_cal_data['node_pos'][:]
        node_pos=np.array(node_pos)
        node_sld=scatt_cal_data['node_sld'][:]
        node_sld=np.array(node_sld)
        pseudo_pos=scatt_cal_data['pseudo_pos'][:]
        pseudo_pos=np.array(pseudo_pos)
        pseudo_b=scatt_cal_data['pseudo_b'][:]
        pseudo_b=np.array(pseudo_b)
        pseudo_b_cat_val=scatt_cal_data['pseudo_b_cat_val'][:]
        pseudo_b_cat_val=np.array(pseudo_b_cat_val)
        pseudo_b_cat_idx=scatt_cal_data['pseudo_b_cat_idx'][:]
        scatt_cal_data.close()

        # determine sld min and max for plotting
        sld_min=np.min(node_sld,0)
        sld_max=np.max(node_sld,0)


        if idx_ensem==0:
            if el_type=='lagrangian':
                num_node_x=el_order*nx+1
                num_node_y=el_order*ny+1
                num_node_z=el_order*nz+1
            # plotting node SLD
            ## cutting at z = cut_frac * length_z
            cut_frac=0.5
            node_pos_3d=node_pos.reshape((num_node_x, num_node_y, num_node_z, 3))
            z_idx= np.floor(cut_frac*(nz+1)).astype(int)
            z_val=node_pos_3d[0, 0, z_idx , 2]
            ## figure specification (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_gen:[86:138]
==models.box.box_gen:[82:134]
num_points=100
num_orientation=200

### run_vars ###
struct_gen_run=1
sim_run=1
scatt_cal_run=1

"""
xml gen and run scripts
"""
part_str='Part>>>  '
info_str='Info>>>  '

print('-------------------------------------------------')
print(part_str + 'Generating mesh')
print('')
# time counter start - struct gen
tic_sg = time.perf_counter()
if struct_gen_run==1:
    # generate xml for struct_gen
    print(info_str + 'Generating struct_gen.xml')
    xml_gen.struct_xml_write(xml_dir,
                              length_a, length_b, length_c,
                                nx, ny, nz,
                                  el_type, el_order,
                                    update_val, plt_node, plt_cell, plt_mesh)

    # generate structure
    print(info_str + 'Executing struct_gen.py')
    script_path = os.path.join(script_dir, 'struct_gen.py')  # Full path of the script
    #working_dir = "."  # Directory to run the script in
    subprocess.run(["python", script_path], cwd=working_dir, stderr=subprocess.PIPE, check=True)
else:
    print(info_str + 'structure generation not attempted')
# time counter end - struct gen
toc_sg = time.perf_counter()
ttot_sg= round(toc_sg - tic_sg,3)
print(f'Time taken for generating mesh: {ttot_sg} s')
print('-------------------------------------------------')

print('-------------------------------------------------')
print(part_str + 'Assigning SLD values to nodes')
print('')
# time counter start - simulation gen
tic_sim = time.perf_counter()
if sim_run==1:
    # simulation xml
    print(info_str + 'Generating simulation.xml')
    xml_gen.sim_xml_write(xml_dir, sim_model,dt, t_end, n_ensem)

    # model xml (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_plot:[252:302]
==models.ball.ball_plot:[190:238]
    t_dir_name=f't{i:0>3}'
    t_dir=os.path.join(model_param_dir, t_dir_name)
    for j in range(n_ensem):
        idx_ensem=j
        # create ensemble dir
        ensem_dir_name=f'ensem{idx_ensem:0>3}'
        ensem_dir=os.path.join(t_dir, ensem_dir_name)

        # create scatt dir
        scatt_dir_name='scatt_cal_'+ scatt_settings
        scatt_dir=os.path.join(ensem_dir, scatt_dir_name)


        #########################################
        # read pseudo atom info from scatt_cal.h5
        #########################################

        # read node sld
        # save pseudo atom info
        scatt_cal_dir_name='scatt_cal_' + scatt_settings
        scatt_cal_dir=os.path.join(ensem_dir, scatt_cal_dir_name)
        scatt_cal_data_file_name='scatt_cal.h5'
        scatt_cal_data_file=os.path.join(scatt_cal_dir, scatt_cal_data_file_name)
        scatt_cal_data=h5py.File(scatt_cal_data_file,'r')
        node_pos=scatt_cal_data['node_pos'][:]
        node_pos=np.array(node_pos)
        node_sld=scatt_cal_data['node_sld'][:]
        node_sld=np.array(node_sld)
        pseudo_pos=scatt_cal_data['pseudo_pos'][:]
        pseudo_pos=np.array(pseudo_pos)
        pseudo_b=scatt_cal_data['pseudo_b'][:]
        pseudo_b=np.array(pseudo_b)
        pseudo_b_cat_val=scatt_cal_data['pseudo_b_cat_val'][:]
        pseudo_b_cat_val=np.array(pseudo_b_cat_val)
        pseudo_b_cat_idx=scatt_cal_data['pseudo_b_cat_idx'][:]
        scatt_cal_data.close()

        # determine sld min and max for plotting
        sld_min=np.min(node_sld,0)
        sld_max=np.max(node_sld,0)

        if idx_ensem==0:
            if el_type=='lagrangian':
                num_node_x=el_order*nx+1
                num_node_y=el_order*ny+1
                num_node_z=el_order*nz+1
            # plotting node SLD
            ## cutting at z = cut_frac * length_z
            cut_frac=0.5
            node_pos_3d=node_pos.reshape((num_node_x, num_node_y, num_node_z, 3)) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_plot:[33:98]
==bib_plot:[33:100]
lib_dir = os.path.abspath(os.path.join(os.path.dirname(__file__), '../..'))
# add .. in path
sys.path.append(lib_dir)
# lib imports (if any)

# ignore warnings
warnings.filterwarnings("ignore")

# analytical SAS function
def J1(x):
    """
    function desc:
    spherical bessel function
    """
    if x==0:
        y= 0
    else:
        y = (np.sin(x)-x*np.cos(x))/x**2
    return y

def arrange_order(a,b,c):
    """
    function desc:
    sort values
    """
    zusammen=[a,b,c]
    zusammen.sort()
    return zusammen[0], zusammen[1], zusammen[2]

def gauss_legendre_double_integrate(func, domain1, domain2, deg):
    """
    function desc:
    numerical integration using gauss points
    """
    x, w = np.polynomial.legendre.leggauss(deg)
    xgrid, ygrid=np.meshgrid(x,x)
    x=xgrid.reshape((1,np.size(xgrid)))
    y=ygrid.reshape((1,np.size(ygrid)))
    wx, wy=np.meshgrid(w,w)
    w1=wx.reshape((1,np.size(wx)))
    w2=wy.reshape((1,np.size(wy)))
    s1 = (domain1[1] - domain1[0])/2
    a1 = (domain1[1] + domain1[0])/2
    s2 = (domain2[1] - domain2[0])/2
    a2 = (domain2[1] + domain2[0])/2
    return np.sum(s1*s2*w1*w2*func(s1*x + a1,s2*y + a2))

def ball_in_box_ecc(qmax,qmin,Npts,scale,scale2,bg,sld_box, sld_ball,sld_sol,
                    len_x,len_y,len_z,radius, origin_shift):
    """
    function desc:
    analytical SAS pattern of eccentric sphere in parallelepiped
    """
    len_x,len_y,len_z=arrange_order(len_x,len_y,len_z)
    vol_box=len_x*len_y*len_z
    vol_ball=(4/3)*np.pi*radius**3
    # SLD unit 10^-5 \AA^-2
    del_rho_box=sld_box-sld_sol
    del_rho_ball=sld_ball-sld_sol
    q_arr=np.linspace(qmin,qmax,Npts)
    Aq_arr=np.zeros(len(q_arr))
    for q_idx, q_cur in enumerate(q_arr): # pylint: disable=unused-variable
        # pylint: disable=cell-var-from-loop, unnecessary-lambda-assignment
        if q_cur==0:
            func=lambda alpha, psi:\ (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.ball.ball_plot:[190:237]
==models.box.box_plot:[208:258]
    t_dir_name=f't{i:0>3}'
    t_dir=os.path.join(model_param_dir, t_dir_name)
    for j in range(n_ensem):
        idx_ensem=j
        # create ensemble dir
        ensem_dir_name=f'ensem{idx_ensem:0>3}'
        ensem_dir=os.path.join(t_dir, ensem_dir_name)

        # create scatt dir
        scatt_dir_name='scatt_cal_'+ scatt_settings
        scatt_dir=os.path.join(ensem_dir, scatt_dir_name)


        #########################################
        # read pseudo atom info from scatt_cal.h5
        #########################################
        # read node sld
        # save pseudo atom info
        scatt_cal_dir_name='scatt_cal_' + scatt_settings
        scatt_cal_dir=os.path.join(ensem_dir, scatt_cal_dir_name)
        scatt_cal_data_file_name='scatt_cal.h5'
        scatt_cal_data_file=os.path.join(scatt_cal_dir, scatt_cal_data_file_name)
        scatt_cal_data=h5py.File(scatt_cal_data_file,'r')
        node_pos=scatt_cal_data['node_pos'][:]
        node_pos=np.array(node_pos)
        node_sld=scatt_cal_data['node_sld'][:]
        node_sld=np.array(node_sld)
        pseudo_pos=scatt_cal_data['pseudo_pos'][:]
        pseudo_pos=np.array(pseudo_pos)
        pseudo_b=scatt_cal_data['pseudo_b'][:]
        pseudo_b=np.array(pseudo_b)
        pseudo_b_cat_val=scatt_cal_data['pseudo_b_cat_val'][:]
        pseudo_b_cat_val=np.array(pseudo_b_cat_val)
        pseudo_b_cat_idx=scatt_cal_data['pseudo_b_cat_idx'][:]
        scatt_cal_data.close()

        # determine sld min and max for plotting
        sld_min=np.min(node_sld,0)
        sld_max=np.max(node_sld,0)
        if idx_ensem==0:
            if el_type=='lagrangian':
                num_node_x=el_order*nx+1
                num_node_y=el_order*ny+1
                num_node_z=el_order*nz+1
            # plotting node SLD
            ## cutting at z = cut_frac * length_z
            cut_frac=0.5 (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.ball.ball_gen:[88:137]
==models.box.box_gen:[86:135]
struct_gen_run=1
sim_run=1
scatt_cal_run=1

"""
xml gen and run scripts
"""
part_str='Part>>>  '
info_str='Info>>>  '

print('-------------------------------------------------')
print(part_str + 'Generating mesh')
print('')
# time counter start - struct gen
tic_sg = time.perf_counter()
if struct_gen_run==1:
    # generate xml for struct_gen
    print(info_str + 'Generating struct_gen.xml')
    xml_gen.struct_xml_write(xml_dir,
                              length_a, length_b, length_c,
                                nx, ny, nz,
                                  el_type, el_order,
                                    update_val, plt_node, plt_cell, plt_mesh)

    # generate structure
    print(info_str + 'Executing struct_gen.py')
    script_path = os.path.join(script_dir, 'struct_gen.py')  # Full path of the script
    #working_dir = "."  # Directory to run the script in
    subprocess.run(["python", script_path], cwd=working_dir, stderr=subprocess.PIPE, check=True)
else:
    print(info_str + 'structure generation not attempted')
# time counter end - struct gen
toc_sg = time.perf_counter()
ttot_sg= round(toc_sg - tic_sg,3)
print(f'Time taken for generating mesh: {ttot_sg} s')
print('-------------------------------------------------')

print('-------------------------------------------------')
print(part_str + 'Assigning SLD values to nodes')
print('')
# time counter start - simulation gen
tic_sim = time.perf_counter()
if sim_run==1:
    # simulation xml
    print(info_str + 'Generating simulation.xml')
    xml_gen.sim_xml_write(xml_dir, sim_model,dt, t_end, n_ensem)

    # model xml
    print(info_str + 'Generating model_ball.xml') (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==scatt_cal:[35:108]
==sig_eff_cal:[33:104]
lib_dir = os.path.abspath(os.path.join(os.path.dirname(__file__), '..'))
# add .. in path
sys.path.append(lib_dir)
# lib imports
from lib import struct_gen as sg # pylint: disable=wrong-import-position

#timer counter initial
tic = time.perf_counter()

##########################
# read input from xml file
##########################

### struct xml ###
xml_folder='./xml/'

struct_xml=os.path.join(xml_folder, 'struct.xml')

tree=ET.parse(struct_xml)
root = tree.getroot()

# box side lengths
length_a=float(root.find('lengths').find('x').text)
length_b=float(root.find('lengths').find('y').text)
length_c=float(root.find('lengths').find('z').text)
# number of cells in each direction
nx=int(root.find('num_cell').find('x').text)
ny=int(root.find('num_cell').find('y').text)
nz=int(root.find('num_cell').find('z').text)
# mid point of structure
mid_point=np.array([length_a/2, length_b/2, length_c/2])
# element type
el_type=root.find('element').find('type').text
if el_type=='lagrangian':
    el_order=int(root.find('element').find('order').text)
    el_info={'type': el_type,
             'order': el_order}

### sim xml ###

sim_xml=os.path.join(xml_folder, 'simulation.xml')

tree=ET.parse(sim_xml)
root = tree.getroot()

# model name
sim_model=root.find('model').text

# simulation parameters
## time
dt=float(root.find('sim_param').find('dt').text)
t_end=float(root.find('sim_param').find('tend').text)
t_arr=np.arange(0,t_end+dt, dt)
## ensemble
n_ensem=int(root.find('sim_param').find('n_ensem').text)


### scatt_cal xml ###
# scatter calculation
# scatt_cal
scatt_cal_xml=os.path.join(xml_folder, 'scatt_cal.xml')

tree=ET.parse(scatt_cal_xml)
root = tree.getroot()

# decreitization params
# number of categories and method of categorization
num_cat=int(root.find('discretization').find('num_cat').text)
method_cat=root.find('discretization').find('method_cat').text

# scatt_cal params (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.gg.gg_plot:[219:266]
==phase_field_plot:[190:238]
        for j in range(n_ensem):
            idx_ensem=j
            # create ensemble dir
            ensem_dir_name=f'ensem{idx_ensem:0>3}'
            ensem_dir=os.path.join(t_dir, ensem_dir_name)

            # create scatt dir
            scatt_dir_name='scatt_cal_'+ scatt_settings
            scatt_dir=os.path.join(ensem_dir, scatt_dir_name)


            """
            read pseudo atom info from scatt_cal.h5
            """
            # read node sld
            # save pseudo atom info
            scatt_cal_dir_name='scatt_cal_' + scatt_settings
            scatt_cal_dir=os.path.join(ensem_dir, scatt_cal_dir_name)
            scatt_cal_data_file_name='scatt_cal.h5'
            scatt_cal_data_file=os.path.join(scatt_cal_dir, scatt_cal_data_file_name)
            scatt_cal_data=h5py.File(scatt_cal_data_file,'r')
            node_pos=scatt_cal_data['node_pos'][:]
            node_pos=np.array(node_pos)
            node_sld=scatt_cal_data['node_sld'][:]
            node_sld=np.array(node_sld)
            pseudo_pos=scatt_cal_data['pseudo_pos'][:]
            pseudo_pos=np.array(pseudo_pos)
            pseudo_b=scatt_cal_data['pseudo_b'][:]
            pseudo_b=np.array(pseudo_b)
            pseudo_b_cat_val=scatt_cal_data['pseudo_b_cat_val'][:]
            pseudo_b_cat_val=np.array(pseudo_b_cat_val)
            pseudo_b_cat_idx=scatt_cal_data['pseudo_b_cat_idx'][:]
            scatt_cal_data.close()

            # determine sld min and max for plotting
            sld_min=np.min(node_sld,0)
            sld_max=np.max(node_sld,0)


            if idx_ensem==0:
                if el_type=='lagrangian':
                    num_node_x=el_order*nx+1
                    num_node_y=el_order*ny+1
                    num_node_z=el_order*nz+1
                # plotting node SLD
                ## cutting at z = cut_frac * length_z
                cut_frac=0.5
                node_pos_3d=node_pos.reshape((num_node_x, num_node_y, num_node_z, 3)) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==fs_gen:[91:139]
==models.gg.gg_gen:[90:138]
struct_gen_run=1
sim_run=1
scatt_cal_run=1

"""
xml gen and run scripts
"""
part_str='Part>>>  '
info_str='Info>>>  '

print('-------------------------------------------------')
print(part_str + 'Generating mesh')
print('')
# time counter start - struct gen
tic_sg = time.perf_counter()
if struct_gen_run==1:
    # generate xml for struct_gen
    print(info_str + 'Generating struct_gen.xml')
    xml_gen.struct_xml_write(xml_dir,
                              length_a, length_b, length_c,
                                nx, ny, nz,
                                  el_type, el_order,
                                    update_val, plt_node, plt_cell, plt_mesh)

    # generate structure
    print(info_str + 'Executing struct_gen.py')
    script_path = os.path.join(script_dir, 'struct_gen.py')  # Full path of the script
    #working_dir = "."  # Directory to run the script in
    subprocess.run(["python", script_path], cwd=working_dir, stderr=subprocess.PIPE, check=True)
else:
    print(info_str + 'structure generation not attempted')
# time counter end - struct gen
toc_sg = time.perf_counter()
ttot_sg= round(toc_sg - tic_sg,3)
print(f'Time taken for generating mesh: {ttot_sg} s')
print('-------------------------------------------------')

print('-------------------------------------------------')
print(part_str + 'Assigning SLD values to nodes')
print('')
# time counter start - simulation gen
tic_sim = time.perf_counter()
if sim_run==1:
    # simulation xml
    print(info_str + 'Generating simulation.xml')
    xml_gen.sim_xml_write(xml_dir, sim_model,dt, t_end, n_ensem)

    # model xml (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_gen:[91:139]
==models.box.box_gen:[86:134]
struct_gen_run=1
sim_run=1
scatt_cal_run=1

"""
xml gen and run scripts
"""
part_str='Part>>>  '
info_str='Info>>>  '

print('-------------------------------------------------')
print(part_str + 'Generating mesh')
print('')
# time counter start - struct gen
tic_sg = time.perf_counter()
if struct_gen_run==1:
    # generate xml for struct_gen
    print(info_str + 'Generating struct_gen.xml')
    xml_gen.struct_xml_write(xml_dir,
                              length_a, length_b, length_c,
                                nx, ny, nz,
                                  el_type, el_order,
                                    update_val, plt_node, plt_cell, plt_mesh)

    # generate structure
    print(info_str + 'Executing struct_gen.py')
    script_path = os.path.join(script_dir, 'struct_gen.py')  # Full path of the script
    #working_dir = "."  # Directory to run the script in
    subprocess.run(["python", script_path], cwd=working_dir, stderr=subprocess.PIPE, check=True)
else:
    print(info_str + 'structure generation not attempted')
# time counter end - struct gen
toc_sg = time.perf_counter()
ttot_sg= round(toc_sg - tic_sg,3)
print(f'Time taken for generating mesh: {ttot_sg} s')
print('-------------------------------------------------')

print('-------------------------------------------------')
print(part_str + 'Assigning SLD values to nodes')
print('')
# time counter start - simulation gen
tic_sim = time.perf_counter()
if sim_run==1:
    # simulation xml
    print(info_str + 'Generating simulation.xml')
    xml_gen.sim_xml_write(xml_dir, sim_model,dt, t_end, n_ensem)

    # model xml (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_plot:[257:305]
==bib_plot:[241:288]
        ensem_dir_name=f'ensem{idx_ensem:0>3}'
        ensem_dir=os.path.join(t_dir, ensem_dir_name)

        # create scatt dir
        scatt_dir_name='scatt_cal_'+ scatt_settings
        scatt_dir=os.path.join(ensem_dir, scatt_dir_name)


        #########################################
        # read pseudo atom info from scatt_cal.h5
        #########################################

        # read node sld
        # save pseudo atom info
        scatt_cal_dir_name='scatt_cal_' + scatt_settings
        scatt_cal_dir=os.path.join(ensem_dir, scatt_cal_dir_name)
        scatt_cal_data_file_name='scatt_cal.h5'
        scatt_cal_data_file=os.path.join(scatt_cal_dir, scatt_cal_data_file_name)
        scatt_cal_data=h5py.File(scatt_cal_data_file,'r')
        node_pos=scatt_cal_data['node_pos'][:]
        node_pos=np.array(node_pos)
        node_sld=scatt_cal_data['node_sld'][:]
        node_sld=np.array(node_sld)
        pseudo_pos=scatt_cal_data['pseudo_pos'][:]
        pseudo_pos=np.array(pseudo_pos)
        pseudo_b=scatt_cal_data['pseudo_b'][:]
        pseudo_b=np.array(pseudo_b)
        pseudo_b_cat_val=scatt_cal_data['pseudo_b_cat_val'][:]
        pseudo_b_cat_val=np.array(pseudo_b_cat_val)
        pseudo_b_cat_idx=scatt_cal_data['pseudo_b_cat_idx'][:]
        scatt_cal_data.close()

        # determine sld min and max for plotting
        sld_min=np.min(node_sld,0)
        sld_max=np.max(node_sld,0)

        if idx_ensem==0:
            if el_type=='lagrangian':
                num_node_x=el_order*nx+1
                num_node_y=el_order*ny+1
                num_node_z=el_order*nz+1
            # plotting node SLD
            ## cutting at z = cut_frac * length_z
            cut_frac=0.5
            node_pos_3d=node_pos.reshape((num_node_x, num_node_y, num_node_z, 3))
            z_idx= np.floor(cut_frac*(nz+1)).astype(int)
            z_val=node_pos_3d[0, 0, z_idx , 2]
            ## figure specification (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==fs_plot:[228:276]
==models.ball.ball_plot:[192:238]
    for j in range(n_ensem):
        idx_ensem=j
        # create ensemble dir
        ensem_dir_name=f'ensem{idx_ensem:0>3}'
        ensem_dir=os.path.join(t_dir, ensem_dir_name)

        # create scatt dir
        scatt_dir_name='scatt_cal_'+ scatt_settings
        scatt_dir=os.path.join(ensem_dir, scatt_dir_name)


        """
        read pseudo atom info from scatt_cal.h5
        """
        # read node sld
        # save pseudo atom info
        scatt_cal_dir_name='scatt_cal_' + scatt_settings
        scatt_cal_dir=os.path.join(ensem_dir, scatt_cal_dir_name)
        scatt_cal_data_file_name='scatt_cal.h5'
        scatt_cal_data_file=os.path.join(scatt_cal_dir, scatt_cal_data_file_name)
        scatt_cal_data=h5py.File(scatt_cal_data_file,'r')
        node_pos=scatt_cal_data['node_pos'][:]
        node_pos=np.array(node_pos)
        node_sld=scatt_cal_data['node_sld'][:]
        node_sld=np.array(node_sld)
        pseudo_pos=scatt_cal_data['pseudo_pos'][:]
        pseudo_pos=np.array(pseudo_pos)
        pseudo_b=scatt_cal_data['pseudo_b'][:]
        pseudo_b=np.array(pseudo_b)
        pseudo_b_cat_val=scatt_cal_data['pseudo_b_cat_val'][:]
        pseudo_b_cat_val=np.array(pseudo_b_cat_val)
        pseudo_b_cat_idx=scatt_cal_data['pseudo_b_cat_idx'][:]
        scatt_cal_data.close()

        # determine sld min and max for plotting
        sld_min=np.min(node_sld,0)
        sld_max=np.max(node_sld,0)


        if idx_ensem==0:
            if el_type=='lagrangian':
                num_node_x=el_order*nx+1
                num_node_y=el_order*ny+1
                num_node_z=el_order*nz+1
            # plotting node SLD
            ## cutting at z = cut_frac * length_z
            cut_frac=0.5
            node_pos_3d=node_pos.reshape((num_node_x, num_node_y, num_node_z, 3)) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_gen:[90:138]
==models.ball.ball_gen:[88:136]
struct_gen_run=1
sim_run=1
scatt_cal_run=1

"""
xml gen and run scripts
"""
part_str='Part>>>  '
info_str='Info>>>  '

print('-------------------------------------------------')
print(part_str + 'Generating mesh')
print('')
# time counter start - struct gen
tic_sg = time.perf_counter()
if struct_gen_run==1:
    # generate xml for struct_gen
    print(info_str + 'Generating struct_gen.xml')
    xml_gen.struct_xml_write(xml_dir,
                              length_a, length_b, length_c,
                                nx, ny, nz,
                                  el_type, el_order,
                                    update_val, plt_node, plt_cell, plt_mesh)

    # generate structure
    print(info_str + 'Executing struct_gen.py')
    script_path = os.path.join(script_dir, 'struct_gen.py')  # Full path of the script
    #working_dir = "."  # Directory to run the script in
    subprocess.run(["python", script_path], cwd=working_dir, stderr=subprocess.PIPE, check=True)
else:
    print(info_str + 'structure generation not attempted')
# time counter end - struct gen
toc_sg = time.perf_counter()
ttot_sg= round(toc_sg - tic_sg,3)
print(f'Time taken for generating mesh: {ttot_sg} s')
print('-------------------------------------------------')

print('-------------------------------------------------')
print(part_str + 'Assigning SLD values to nodes')
print('')
# time counter start - simulation gen
tic_sim = time.perf_counter()
if sim_run==1:
    # simulation xml
    print(info_str + 'Generating simulation.xml')
    xml_gen.sim_xml_write(xml_dir, sim_model,dt, t_end, n_ensem)

    # model xml (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==fs_plot:[228:275]
==models.box.box_plot:[210:258]
    for j in range(n_ensem):
        idx_ensem=j
        # create ensemble dir
        ensem_dir_name=f'ensem{idx_ensem:0>3}'
        ensem_dir=os.path.join(t_dir, ensem_dir_name)

        # create scatt dir
        scatt_dir_name='scatt_cal_'+ scatt_settings
        scatt_dir=os.path.join(ensem_dir, scatt_dir_name)


        """
        read pseudo atom info from scatt_cal.h5
        """
        # read node sld
        # save pseudo atom info
        scatt_cal_dir_name='scatt_cal_' + scatt_settings
        scatt_cal_dir=os.path.join(ensem_dir, scatt_cal_dir_name)
        scatt_cal_data_file_name='scatt_cal.h5'
        scatt_cal_data_file=os.path.join(scatt_cal_dir, scatt_cal_data_file_name)
        scatt_cal_data=h5py.File(scatt_cal_data_file,'r')
        node_pos=scatt_cal_data['node_pos'][:]
        node_pos=np.array(node_pos)
        node_sld=scatt_cal_data['node_sld'][:]
        node_sld=np.array(node_sld)
        pseudo_pos=scatt_cal_data['pseudo_pos'][:]
        pseudo_pos=np.array(pseudo_pos)
        pseudo_b=scatt_cal_data['pseudo_b'][:]
        pseudo_b=np.array(pseudo_b)
        pseudo_b_cat_val=scatt_cal_data['pseudo_b_cat_val'][:]
        pseudo_b_cat_val=np.array(pseudo_b_cat_val)
        pseudo_b_cat_idx=scatt_cal_data['pseudo_b_cat_idx'][:]
        scatt_cal_data.close()

        # determine sld min and max for plotting
        sld_min=np.min(node_sld,0)
        sld_max=np.max(node_sld,0)


        if idx_ensem==0:
            if el_type=='lagrangian':
                num_node_x=el_order*nx+1
                num_node_y=el_order*ny+1
                num_node_z=el_order*nz+1
            # plotting node SLD
            ## cutting at z = cut_frac * length_z
            cut_frac=0.5 (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[241:285]
==models.ball.ball_plot:[195:238]
        ensem_dir_name=f'ensem{idx_ensem:0>3}'
        ensem_dir=os.path.join(t_dir, ensem_dir_name)

        # create scatt dir
        scatt_dir_name='scatt_cal_'+ scatt_settings
        scatt_dir=os.path.join(ensem_dir, scatt_dir_name)


        """
        read pseudo atom info from scatt_cal.h5
        """
        # read node sld
        # save pseudo atom info
        scatt_cal_dir_name='scatt_cal_' + scatt_settings
        scatt_cal_dir=os.path.join(ensem_dir, scatt_cal_dir_name)
        scatt_cal_data_file_name='scatt_cal.h5'
        scatt_cal_data_file=os.path.join(scatt_cal_dir, scatt_cal_data_file_name)
        scatt_cal_data=h5py.File(scatt_cal_data_file,'r')
        node_pos=scatt_cal_data['node_pos'][:]
        node_pos=np.array(node_pos)
        node_sld=scatt_cal_data['node_sld'][:]
        node_sld=np.array(node_sld)
        pseudo_pos=scatt_cal_data['pseudo_pos'][:]
        pseudo_pos=np.array(pseudo_pos)
        pseudo_b=scatt_cal_data['pseudo_b'][:]
        pseudo_b=np.array(pseudo_b)
        pseudo_b_cat_val=scatt_cal_data['pseudo_b_cat_val'][:]
        pseudo_b_cat_val=np.array(pseudo_b_cat_val)
        pseudo_b_cat_idx=scatt_cal_data['pseudo_b_cat_idx'][:]
        scatt_cal_data.close()

        # determine sld min and max for plotting
        sld_min=np.min(node_sld,0)
        sld_max=np.max(node_sld,0)

        if idx_ensem==0:
            if el_type=='lagrangian':
                num_node_x=el_order*nx+1
                num_node_y=el_order*ny+1
                num_node_z=el_order*nz+1
            # plotting node SLD
            ## cutting at z = cut_frac * length_z
            cut_frac=0.5
            node_pos_3d=node_pos.reshape((num_node_x, num_node_y, num_node_z, 3)) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.gg.gg_plot:[266:310]
==sld_grow_plot:[262:304]
            z_idx= np.floor(cut_frac*(nz+1)).astype(int)
            z_val=node_pos_3d[0, 0, z_idx , 2]
            ## figure specification
            plot_file_name=f'SLD_{sim_model}_{t_str}.pdf'
            plot_file=os.path.join(plot_dir,plot_file_name)
            fig, ax = plt.subplots(figsize=(5, 5))
            ## image plot
            ### .T is required to exchange x and y axis
            ### origin is 'lower' to put it in lower left corner
            node_sld_3d=node_sld.reshape((nx+1, ny+1, nz+1))
            img = ax.imshow(node_sld_3d[:,:,z_idx].T,
                             extent=[0, length_a, 0, length_b],
                               origin='lower', vmin=sld_min, vmax=sld_max, interpolation='bilinear')
            ## color bar
            cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
            cbar_label=r"Scattering length density (SLD) [$10^{-5} \cdot \mathrm{\AA}^{-2}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title
            title_text=" Cut at Z = {0} {1}".format(z_val, r"$\mathrm{\AA}$")
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            ## add mesh
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))
            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

            # plotting pseudo atoms
            ## cutting at z = z_val + length_z
            # cell_z= length_c/nz
            # z_val_pseudo=z_val+cell_z
            cut_frac=0.5
            pseudo_pos_3d=pseudo_pos.reshape((nx, ny, nz, 3))
            pseudo_b_3d=pseudo_b.reshape((nx, ny, nz)) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[241:284]
==models.box.box_plot:[213:258]
        ensem_dir_name=f'ensem{idx_ensem:0>3}'
        ensem_dir=os.path.join(t_dir, ensem_dir_name)

        # create scatt dir
        scatt_dir_name='scatt_cal_'+ scatt_settings
        scatt_dir=os.path.join(ensem_dir, scatt_dir_name)


        #########################################
        # read pseudo atom info from scatt_cal.h5
        #########################################

        # read node sld
        # save pseudo atom info
        scatt_cal_dir_name='scatt_cal_' + scatt_settings
        scatt_cal_dir=os.path.join(ensem_dir, scatt_cal_dir_name)
        scatt_cal_data_file_name='scatt_cal.h5'
        scatt_cal_data_file=os.path.join(scatt_cal_dir, scatt_cal_data_file_name)
        scatt_cal_data=h5py.File(scatt_cal_data_file,'r')
        node_pos=scatt_cal_data['node_pos'][:]
        node_pos=np.array(node_pos)
        node_sld=scatt_cal_data['node_sld'][:]
        node_sld=np.array(node_sld)
        pseudo_pos=scatt_cal_data['pseudo_pos'][:]
        pseudo_pos=np.array(pseudo_pos)
        pseudo_b=scatt_cal_data['pseudo_b'][:]
        pseudo_b=np.array(pseudo_b)
        pseudo_b_cat_val=scatt_cal_data['pseudo_b_cat_val'][:]
        pseudo_b_cat_val=np.array(pseudo_b_cat_val)
        pseudo_b_cat_idx=scatt_cal_data['pseudo_b_cat_idx'][:]
        scatt_cal_data.close()

        # determine sld min and max for plotting
        sld_min=np.min(node_sld,0)
        sld_max=np.max(node_sld,0)


        if idx_ensem==0:
            if el_type=='lagrangian':
                num_node_x=el_order*nx+1
                num_node_y=el_order*ny+1
                num_node_z=el_order*nz+1
            # plotting node SLD
            ## cutting at z = cut_frac * length_z
            cut_frac=0.5 (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.ball.ball_plot:[242:284]
==phase_field_plot:[242:287]
            plot_file=os.path.join(plot_dir,plot_file_name)
            fig, ax = plt.subplots(figsize=(5, 5))
            ## image plot
            ### .T is required to exchange x and y axis
            ### origin is 'lower' to put it in lower left corner
            node_sld_3d=node_sld.reshape((num_node_x, num_node_y, num_node_z))
            img = ax.imshow(node_sld_3d[:,:,z_idx].T,
                             extent=[0, length_a, 0, length_b],
                               origin='lower', vmin=sld_min, vmax=sld_max,
                                 interpolation='bilinear')
            ## color bar
            cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
            cbar_label=r"Scattering length density (SLD) [$10^{-5} \cdot \mathrm{\AA}^{-2}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title
            title_text=" Cut at Z = {0} {1}".format(z_val, r"$\mathrm{\AA}$")
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            ## add mesh
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))
            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

            # plotting pseudo atoms
            ## cutting at z = z_val + length_z
            # cell_z= length_c/nz
            # z_val_pseudo=z_val+cell_z
            cut_frac=0.5
            pseudo_pos_3d=pseudo_pos.reshape((nx, ny, nz, 3))
            pseudo_b_3d=pseudo_b.reshape((nx, ny, nz))
            z_idx_pseudo= nz//2-1 #z_idx-1
            z_val_pseudo=pseudo_pos_3d[0, 0, z_idx_pseudo , 2]
            ## figure specification (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.ball.ball_gen:[95:136]
==sld_grow_gen:[112:153]
part_str='Part>>>  '
info_str='Info>>>  '

print('-------------------------------------------------')
print(part_str + 'Generating mesh')
print('')
# time counter start - struct gen
tic_sg = time.perf_counter()
if struct_gen_run==1:
    # generate xml for struct_gen
    print(info_str + 'Generating struct_gen.xml')
    xml_gen.struct_xml_write(xml_dir,
                              length_a, length_b, length_c,
                                nx, ny, nz,
                                  el_type, el_order,
                                    update_val, plt_node, plt_cell, plt_mesh)

    # generate structure
    print(info_str + 'Executing struct_gen.py')
    script_path = os.path.join(script_dir, 'struct_gen.py')  # Full path of the script
    #working_dir = "."  # Directory to run the script in
    subprocess.run(["python", script_path], cwd=working_dir, stderr=subprocess.PIPE, check=True)
else:
    print(info_str + 'structure generation not attempted')
# time counter end - struct gen
toc_sg = time.perf_counter()
ttot_sg= round(toc_sg - tic_sg,3)
print(f'Time taken for generating mesh: {ttot_sg} s')
print('-------------------------------------------------')

print('-------------------------------------------------')
print(part_str + 'Assigning SLD values to nodes')
print('')
# time counter start - simulation gen
tic_sim = time.perf_counter()
if sim_run==1:
    # simulation xml
    print(info_str + 'Generating simulation.xml')
    xml_gen.sim_xml_write(xml_dir, sim_model,dt, t_end, n_ensem)

    # model xml (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.box.box_plot:[263:305]
==models.gg.gg_plot:[270:313]
            plot_file=os.path.join(plot_dir,plot_file_name)
            fig, ax = plt.subplots(figsize=(5, 5))
            ## image plot
            ### .T is required to exchange x and y axis
            ### origin is 'lower' to put it in lower left corner
            node_sld_3d=node_sld.reshape((nx+1, ny+1, nz+1))
            img = ax.imshow(node_sld_3d[:,:,z_idx].T,
                             extent=[0, length_a, 0, length_b],
                               origin='lower', vmin=sld_min, vmax=sld_max, interpolation='bilinear')

            ## color bar
            cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
            cbar_label=r"Scattering length density (SLD) [$10^{-5} \cdot \mathrm{\AA}^{-2}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title
            title_text=" Cut at Z = {0} {1}".format(z_val, r"$\mathrm{\AA}$")
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            ## add mesh
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))

            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

            # plotting pseudo atoms
            ## cutting at z = z_val + length_z
            # cell_z= length_c/nz
            # z_val_pseudo=z_val+cell_z
            cut_frac=0.5
            pseudo_pos_3d=pseudo_pos.reshape((nx, ny, nz, 3))
            pseudo_b_3d=pseudo_b.reshape((nx, ny, nz))
            z_idx_pseudo= nz//2-1
            z_val_pseudo=pseudo_pos_3d[0, 0, z_idx_pseudo , 2]
            ## figure specification (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_plot:[306:348]
==bib_plot:[289:331]
            plot_file=os.path.join(plot_dir,plot_file_name)
            fig, ax = plt.subplots(figsize=(5, 5))
            ## image plot
            ### .T is required to exchange x and y axis
            ### origin is 'lower' to put it in lower left corner
            node_sld_3d=node_sld.reshape((nx+1, ny+1, nz+1))
            img = ax.imshow(node_sld_3d[:,:,z_idx].T,
                             extent=[0, length_a, 0, length_b],
                               origin='lower', vmin=sld_min, vmax=sld_max, interpolation='bilinear')
            ## color bar
            cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
            cbar_label=r"Scattering length density (SLD) [$10^{-5} \cdot \mathrm{\AA}^{-2}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title
            title_text=" Cut at Z = {0} {1}".format(z_val, r"$\mathrm{\AA}$")
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            ## add mesh
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))

            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

            # plotting pseudo atoms
            ## cutting at z = z_val + length_z
            # cell_z= length_c/nz
            # z_val_pseudo=z_val+cell_z
            cut_frac=0.5
            pseudo_pos_3d=pseudo_pos.reshape((nx, ny, nz, 3))
            pseudo_b_3d=pseudo_b.reshape((nx, ny, nz))
            z_idx_pseudo= z_idx-1
            z_val_pseudo=pseudo_pos_3d[0, 0, z_idx_pseudo , 2]
            ## figure specification (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.ball.ball_gen:[140:179]
==sld_grow_gen:[158:196]
    print(info_str + 'Executing sim_gen.py')
    script_path = os.path.join(script_dir, 'sim_gen.py')  # Full path of the script
    #working_dir = "."  # Directory to run the script in
    subprocess.run(["python", script_path], cwd=working_dir, stderr=subprocess.PIPE, check=True)
else:
    print(info_str + 'simulation not attempted')
# time counter end - simulation gen
toc_sim = time.perf_counter()
ttot_sim= round(toc_sim - tic_sim,3)
print(f'Time taken for assigning SLD values: {ttot_sim} s')
print('-------------------------------------------------')

print('-------------------------------------------------')
print(part_str + 'Calculating SAS pattern')
print('')
# time counter start - SAS calculation
tic_scatt = time.perf_counter()
if scatt_cal_run==1:
    # scatt_cal xml
    print(info_str + 'Generating scatt_cal.xml')
    xml_gen.scatt_cal_xml_write(xml_dir, num_cat, method_cat,
                                sassena_exe, mpi_procs, num_threads,
                                sig_file, scan_vec, Q_range,
                                num_points, num_orientation)

    # calculate scattering function
    print(info_str + 'Executing scatt_cal.py')
    script_path = os.path.join(script_dir, 'scatt_cal.py')  # Full path of the script
    #working_dir = "."  # Directory to run the script in
    subprocess.run(["python", script_path], cwd=working_dir, stderr=subprocess.PIPE, check=True)
else:
    print(info_str + 'Calculation of scattring function not attempted')
# time counter end - SAS calculation
toc_scatt = time.perf_counter()
ttot_scatt= round(toc_scatt - tic_scatt,3)
print(f'Time taken for calculating SAS pattern: {ttot_scatt} s')
print('-------------------------------------------------')

# Time satistics (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==scatt_cal:[35:97]
==sim_gen:[34:104]
lib_dir = os.path.abspath(os.path.join(os.path.dirname(__file__), '..'))
# add .. in path
sys.path.append(lib_dir)
# lib imports
from lib import struct_gen as sg # pylint: disable=wrong-import-position
from lib import simulation as sim # pylint: disable=wrong-import-position




#timer counter initial
tic = time.perf_counter()

##########################
# read input from xml file
##########################

### struct xml ###

xml_folder='./xml/'

struct_xml=os.path.join(xml_folder, 'struct.xml')

tree=ET.parse(struct_xml)
root = tree.getroot()

# box side lengths
length_a=float(root.find('lengths').find('x').text)
length_b=float(root.find('lengths').find('y').text)
length_c=float(root.find('lengths').find('z').text)
# number of cells in each direction
nx=int(root.find('num_cell').find('x').text)
ny=int(root.find('num_cell').find('y').text)
nz=int(root.find('num_cell').find('z').text)
# mid point of structure
mid_point=np.array([length_a/2, length_b/2, length_c/2])
# element type
el_type=root.find('element').find('type').text
if el_type=='lagrangian':
    el_order=int(root.find('element').find('order').text)
    el_info={'type': el_type,
             'order': el_order}

### sim xml ###

sim_xml=os.path.join(xml_folder, 'simulation.xml')

tree=ET.parse(sim_xml)
root = tree.getroot()

# model name
sim_model=root.find('model').text

# simulation parameters
## time
dt=float(root.find('sim_param').find('dt').text)
t_end=float(root.find('sim_param').find('tend').text)
t_arr=np.arange(0,t_end+dt, dt)
## ensemble
n_ensem=int(root.find('sim_param').find('n_ensem').text)


#################################################
# create folder structure and read structure info
#################################################

# folder structure
## mother folder for simulation
### save length values as strings
### decimal points are replaced with p (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_plot:[199:254]
==bib_plot:[183:238]
scatt_settings='cat_' + method_cat + '_' + str(num_cat) + 'Q_' \
    + str(Q_range[0]) + '_' + str(Q_range[1]) + '_' + 'orien__' + str(num_orientation)
scatt_settings=scatt_settings.replace('.', 'p')

"""
read folder structure
"""

# folder structure
## mother folder name
### save length values as strings
### decimal points are replaced with p
length_a_str=str(length_a).replace('.','p')
length_b_str=str(length_a).replace('.','p')
length_c_str=str(length_a).replace('.','p')

### save num_cell values as strings
nx_str=str(nx)
ny_str=str(ny)
nz_str=str(nz)

### save element_order values as strings
el_order_str='lagrangian_' + str(el_order)

mother_dir_name = length_a_str+'_' + length_b_str+'_' + length_c_str\
      + '_' + nx_str + '_' + ny_str + '_' + nz_str + '_' + el_order_str
data_dir=os.path.join(working_dir, 'data')
mother_dir = os.path.join(data_dir, mother_dir_name)

# read structure info
data_file=os.path.join(mother_dir, 'structure/struct.h5')

# folder name for simulation
sim_dir=os.path.join(mother_dir, 'simulation')

### model xml entries ###
# folder name for model
model_dir_name= (sim_model + '_tend_' + str(t_end) + '_dt_' + str(dt) \
    + '_ensem_' + str(n_ensem)).replace('.','p')
model_dir=os.path.join(sim_dir,model_dir_name)

# folder name for model with particular run param
model_param_dir=os.path.join(model_dir,model_param_dir_name)

# create folder for figure (one level up from data folder)
figure_dir=os.path.join(mother_dir, '../../figure/')
os.makedirs(figure_dir, exist_ok=True)
## folder for this suit of figures
plot_dir=os.path.join(figure_dir, sim_model)
os.makedirs(plot_dir, exist_ok=True)

for i, t in enumerate(t_arr):
    # time_dir name
    t_dir_name=f't{i:0>3}'
    t_dir=os.path.join(model_param_dir, t_dir_name) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.gg.gg_plot:[151:203]
==sld_grow_plot:[149:202]
num_points=100
num_orientation=10
# scatt settengs
scatt_settings='cat_' + method_cat + '_' + str(num_cat) + 'Q_' \
    + str(Q_range[0]) + '_' + str(Q_range[1]) + '_' + 'orien__' + str(num_orientation)
scatt_settings=scatt_settings.replace('.', 'p')

"""
read folder structure
"""
# folder structure
## mother folder name
### save length values as strings
### decimal points are replaced with p
length_a_str=str(length_a).replace('.','p')
length_b_str=str(length_a).replace('.','p')
length_c_str=str(length_a).replace('.','p')

### save num_cell values as strings
nx_str=str(nx)
ny_str=str(ny)
nz_str=str(nz)

### save element_order values as strings
el_order_str='lagrangian_' + str(el_order)

mother_dir_name = length_a_str+'_' + length_b_str+'_' + length_c_str\
      + '_' + nx_str + '_' + ny_str + '_' + nz_str + '_' + el_order_str
data_dir=os.path.join(working_dir, 'data')
mother_dir = os.path.join(data_dir, mother_dir_name)

# read structure info
data_file=os.path.join(mother_dir, 'structure/struct.h5')

# folder name for simulation
sim_dir=os.path.join(mother_dir, 'simulation')

# folder name for model
model_dir_name= (sim_model + '_tend_' + str(t_end) + '_dt_' + str(dt) \
    + '_ensem_' + str(n_ensem)).replace('.','p')
model_dir=os.path.join(sim_dir,model_dir_name)

# folder name for model with particular run param
model_param_dir=os.path.join(model_dir,model_param_dir_name)

# create folder for figure (one level up from data folder)
figure_dir=os.path.join(mother_dir, '../../figure/')
os.makedirs(figure_dir, exist_ok=True)
## folder for this suit of figures
plot_dir=os.path.join(figure_dir, sim_model)
os.makedirs(plot_dir, exist_ok=True)
# initialize figures (1: SAS pattern, 2: Fit param) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_plot:[306:345]
==models.gg.gg_plot:[270:310]
            plot_file=os.path.join(plot_dir,plot_file_name)
            fig, ax = plt.subplots(figsize=(5, 5))
            ## image plot
            ### .T is required to exchange x and y axis
            ### origin is 'lower' to put it in lower left corner
            node_sld_3d=node_sld.reshape((nx+1, ny+1, nz+1))
            img = ax.imshow(node_sld_3d[:,:,z_idx].T,
                             extent=[0, length_a, 0, length_b],
                               origin='lower', vmin=sld_min, vmax=sld_max, interpolation='bilinear')

            ## color bar
            cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
            cbar_label=r"Scattering length density (SLD) [$10^{-5} \cdot \mathrm{\AA}^{-2}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title
            title_text=" Cut at Z = {0} {1}".format(z_val, r"$\mathrm{\AA}$")
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            ## add mesh
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))

            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

            # plotting pseudo atoms
            ## cutting at z = z_val + length_z
            # cell_z= length_c/nz
            # z_val_pseudo=z_val+cell_z
            cut_frac=0.5
            pseudo_pos_3d=pseudo_pos.reshape((nx, ny, nz, 3))
            pseudo_b_3d=pseudo_b.reshape((nx, ny, nz)) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[289:328]
==models.box.box_plot:[263:302]
            plot_file=os.path.join(plot_dir,plot_file_name)
            fig, ax = plt.subplots(figsize=(5, 5))
            ## image plot
            ### .T is required to exchange x and y axis
            ### origin is 'lower' to put it in lower left corner
            node_sld_3d=node_sld.reshape((nx+1, ny+1, nz+1))
            img = ax.imshow(node_sld_3d[:,:,z_idx].T,
                             extent=[0, length_a, 0, length_b],
                               origin='lower', vmin=sld_min, vmax=sld_max, interpolation='bilinear')
            ## color bar
            cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
            cbar_label=r"Scattering length density (SLD) [$10^{-5} \cdot \mathrm{\AA}^{-2}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title
            title_text=" Cut at Z = {0} {1}".format(z_val, r"$\mathrm{\AA}$")
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            ## add mesh
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))

            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

            # plotting pseudo atoms
            ## cutting at z = z_val + length_z
            # cell_z= length_c/nz
            # z_val_pseudo=z_val+cell_z
            cut_frac=0.5
            pseudo_pos_3d=pseudo_pos.reshape((nx, ny, nz, 3))
            pseudo_b_3d=pseudo_b.reshape((nx, ny, nz)) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==scatt_cal:[135:171]
==sig_eff_cal:[144:184]
length_a_str=str(length_a).replace('.','p')
length_b_str=str(length_a).replace('.','p')
length_c_str=str(length_a).replace('.','p')

### save num_cell values as strings
nx_str=str(nx)
ny_str=str(ny)
nz_str=str(nz)
struct_folder_name = (length_a_str + '_' + length_b_str + '_' + length_c_str
                       + '_' + nx_str + '_' + ny_str + '_' + nz_str)

# save elemnt type as string
if el_type=='lagrangian':
    el_order_str=str(el_order)
    struct_folder_name += '_' + el_type + '_' + el_order_str


sim_dir=os.path.join('./data/', struct_folder_name +'/simulation')
# sim_dir=os.path.join('../data/',
#                         length_a_str+'_'+length_b_str+'_'+length_c_str+'_'+
#                         nx_str+'_'+ny_str+'_'+nz_str+'/simulation')
os.makedirs(sim_dir, exist_ok=True)

# read structure info
data_filename=os.path.join(sim_dir,'../structure/struct.h5')
nodes, cells, con, mesh = sg.mesh_read(data_filename)

# folder name for model
model_dir_name= (sim_model + '_tend_' + str(t_end) + '_dt_' + str(dt) \
    + '_ensem_' + str(n_ensem)).replace('.','p')
model_dir=os.path.join(sim_dir,model_dir_name)

# folder name for run of model with particular run param
model_xml=os.path.join(xml_folder, 'model_'+sim_model + '.xml')
tree = ET.parse(model_xml)
root = tree.getroot()
model_param_dir_name=''
for elem in root.iter():
    if elem.text and elem.text.strip():  # Avoid None or empty texts
        model_param_dir_name+= f"{elem.tag}_{elem.text.strip()}_" (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==fs_plot:[160:212]
==models.gg.gg_plot:[154:204]
scatt_settings='cat_' + method_cat + '_' + str(num_cat) + 'Q_' \
    + str(Q_range[0]) + '_' + str(Q_range[1]) + '_' + 'orien__' + str(num_orientation)
scatt_settings=scatt_settings.replace('.', 'p')

"""
read folder structure
"""
# folder structure
## mother folder name
### save length values as strings
### decimal points are replaced with p
length_a_str=str(length_a).replace('.','p')
length_b_str=str(length_a).replace('.','p')
length_c_str=str(length_a).replace('.','p')

### save num_cell values as strings
nx_str=str(nx)
ny_str=str(ny)
nz_str=str(nz)

### save element_order values as strings
el_order_str='lagrangian_' + str(el_order)

mother_dir_name = length_a_str+'_' + length_b_str+'_' + length_c_str\
      + '_' + nx_str + '_' + ny_str + '_' + nz_str + '_' + el_order_str
data_dir=os.path.join(working_dir, 'data')
mother_dir = os.path.join(data_dir, mother_dir_name)

# read structure info
data_file=os.path.join(mother_dir, 'structure/struct.h5')

# folder name for simulation
sim_dir=os.path.join(mother_dir, 'simulation')

# folder name for model
model_dir_name= (sim_model + '_tend_' + str(t_end) + '_dt_' + str(dt) \
    + '_ensem_' + str(n_ensem)).replace('.','p')
model_dir=os.path.join(sim_dir,model_dir_name)

# folder name for model with particular run param
model_param_dir=os.path.join(model_dir,model_param_dir_name)

# create folder for figure (one level up from data folder)
figure_dir=os.path.join(mother_dir, '../../figure/')
os.makedirs(figure_dir, exist_ok=True)
## folder for this suit of figures
plot_dir=os.path.join(figure_dir, sim_model)
os.makedirs(plot_dir, exist_ok=True)
# initialize figures (1: SAS pattern, 2: Fit param)
fig_scatt_all, ax_scatt_all = plt.subplots(figsize=(7, 5)) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==fs_plot:[286:322]
==models.box.box_plot:[269:305]
            img = ax.imshow(node_sld_3d[:,:,z_idx].T,
                             extent=[0, length_a, 0, length_b],
                               origin='lower', vmin=sld_min, vmax=sld_max, interpolation='bilinear')
            ## color bar
            cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
            cbar_label=r"Scattering length density (SLD) [$10^{-5} \cdot \mathrm{\AA}^{-2}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title
            title_text=" Cut at Z = {0} {1}".format(z_val, r"$\mathrm{\AA}$")
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            ## add mesh
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))

            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

            # plotting pseudo atoms
            ## cutting at z = z_val + length_z
            # cell_z= length_c/nz
            # z_val_pseudo=z_val+cell_z
            cut_frac=0.5
            pseudo_pos_3d=pseudo_pos.reshape((nx, ny, nz, 3))
            pseudo_b_3d=pseudo_b.reshape((nx, ny, nz))
            z_idx_pseudo= nz//2-1 # z_idx-1
            z_val_pseudo=pseudo_pos_3d[0, 0, z_idx_pseudo , 2]
            ## figure specification (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.ball.ball_plot:[190:227]
==sld_grow_plot:[216:253]
    t_dir_name=f't{i:0>3}'
    t_dir=os.path.join(model_param_dir, t_dir_name)
    for j in range(n_ensem):
        idx_ensem=j
        # create ensemble dir
        ensem_dir_name=f'ensem{idx_ensem:0>3}'
        ensem_dir=os.path.join(t_dir, ensem_dir_name)

        # create scatt dir
        scatt_dir_name='scatt_cal_'+ scatt_settings
        scatt_dir=os.path.join(ensem_dir, scatt_dir_name)


        #########################################
        # read pseudo atom info from scatt_cal.h5
        #########################################
        # read node sld
        # save pseudo atom info
        scatt_cal_dir_name='scatt_cal_' + scatt_settings
        scatt_cal_dir=os.path.join(ensem_dir, scatt_cal_dir_name)
        scatt_cal_data_file_name='scatt_cal.h5'
        scatt_cal_data_file=os.path.join(scatt_cal_dir, scatt_cal_data_file_name)
        scatt_cal_data=h5py.File(scatt_cal_data_file,'r')
        node_pos=scatt_cal_data['node_pos'][:]
        node_pos=np.array(node_pos)
        node_sld=scatt_cal_data['node_sld'][:]
        node_sld=np.array(node_sld)
        pseudo_pos=scatt_cal_data['pseudo_pos'][:]
        pseudo_pos=np.array(pseudo_pos)
        pseudo_b=scatt_cal_data['pseudo_b'][:]
        pseudo_b=np.array(pseudo_b)
        pseudo_b_cat_val=scatt_cal_data['pseudo_b_cat_val'][:]
        pseudo_b_cat_val=np.array(pseudo_b_cat_val)
        pseudo_b_cat_idx=scatt_cal_data['pseudo_b_cat_idx'][:]
        scatt_cal_data.close()

        # determine sld min and max for plotting (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.gg.gg_plot:[151:200]
==sld_grow_plot_joss:[147:196]
num_points=100
num_orientation=10
# scatt settengs
scatt_settings='cat_' + method_cat + '_' + str(num_cat) + 'Q_' \
    + str(Q_range[0]) + '_' + str(Q_range[1]) + '_' + 'orien__' + str(num_orientation)
scatt_settings=scatt_settings.replace('.', 'p')

"""
read folder structure
"""
# folder structure
## mother folder name
### save length values as strings
### decimal points are replaced with p
length_a_str=str(length_a).replace('.','p')
length_b_str=str(length_a).replace('.','p')
length_c_str=str(length_a).replace('.','p')

### save num_cell values as strings
nx_str=str(nx)
ny_str=str(ny)
nz_str=str(nz)

### save element_order values as strings
el_order_str='lagrangian_' + str(el_order)

mother_dir_name = length_a_str+'_' + length_b_str+'_' + length_c_str\
      + '_' + nx_str + '_' + ny_str + '_' + nz_str + '_' + el_order_str
data_dir=os.path.join(working_dir, 'data')
mother_dir = os.path.join(data_dir, mother_dir_name)

# read structure info
data_file=os.path.join(mother_dir, 'structure/struct.h5')

# folder name for simulation
sim_dir=os.path.join(mother_dir, 'simulation')

# folder name for model
model_dir_name= (sim_model + '_tend_' + str(t_end) + '_dt_' + str(dt) \
    + '_ensem_' + str(n_ensem)).replace('.','p')
model_dir=os.path.join(sim_dir,model_dir_name)

# folder name for model with particular run param
model_param_dir=os.path.join(model_dir,model_param_dir_name)

# create folder for figure (one level up from data folder)
figure_dir=os.path.join(mother_dir, '../../figure/')
os.makedirs(figure_dir, exist_ok=True)
## folder for this suit of figures (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.box.box_plot:[154:206]
==sld_grow_plot:[152:202]
scatt_settings='cat_' + method_cat + '_' + str(num_cat) + 'Q_' \
    + str(Q_range[0]) + '_' + str(Q_range[1]) + '_' + 'orien__' + str(num_orientation)
scatt_settings=scatt_settings.replace('.', 'p')

"""
read folder structure
"""
# folder structure
## mother folder name
### save length values as strings
### decimal points are replaced with p
length_a_str=str(length_a).replace('.','p')
length_b_str=str(length_a).replace('.','p')
length_c_str=str(length_a).replace('.','p')

### save num_cell values as strings
nx_str=str(nx)
ny_str=str(ny)
nz_str=str(nz)

### save element_order values as strings
el_order_str='lagrangian_' + str(el_order)

mother_dir_name = length_a_str+'_' + length_b_str+'_' + length_c_str\
      + '_' + nx_str + '_' + ny_str + '_' + nz_str + '_' + el_order_str
data_dir=os.path.join(working_dir, 'data')
mother_dir = os.path.join(data_dir, mother_dir_name)

# read structure info
data_file=os.path.join(mother_dir, 'structure/struct.h5')

# folder name for simulation
sim_dir=os.path.join(mother_dir, 'simulation')

# folder name for model
model_dir_name= (sim_model + '_tend_' + str(t_end) + '_dt_' + str(dt) \
    + '_ensem_' + str(n_ensem)).replace('.','p')
model_dir=os.path.join(sim_dir,model_dir_name)

# folder name for model with particular run param
model_param_dir=os.path.join(model_dir,model_param_dir_name)

# create folder for figure (one level up from data folder)
figure_dir=os.path.join(mother_dir, '../../figure/')
os.makedirs(figure_dir, exist_ok=True)
## folder for this suit of figures
plot_dir=os.path.join(figure_dir, sim_model)
os.makedirs(plot_dir, exist_ok=True)

# initialize fit_params (radius) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_plot:[199:250]
==models.gg.gg_plot:[154:203]
scatt_settings='cat_' + method_cat + '_' + str(num_cat) + 'Q_' \
    + str(Q_range[0]) + '_' + str(Q_range[1]) + '_' + 'orien__' + str(num_orientation)
scatt_settings=scatt_settings.replace('.', 'p')

"""
read folder structure
"""
# folder structure
## mother folder name
### save length values as strings
### decimal points are replaced with p
length_a_str=str(length_a).replace('.','p')
length_b_str=str(length_a).replace('.','p')
length_c_str=str(length_a).replace('.','p')

### save num_cell values as strings
nx_str=str(nx)
ny_str=str(ny)
nz_str=str(nz)

### save element_order values as strings
el_order_str='lagrangian_' + str(el_order)

mother_dir_name = length_a_str+'_' + length_b_str+'_' + length_c_str\
      + '_' + nx_str + '_' + ny_str + '_' + nz_str + '_' + el_order_str
data_dir=os.path.join(working_dir, 'data')
mother_dir = os.path.join(data_dir, mother_dir_name)

# read structure info
data_file=os.path.join(mother_dir, 'structure/struct.h5')

# folder name for simulation
sim_dir=os.path.join(mother_dir, 'simulation')

# folder name for model
model_dir_name= (sim_model + '_tend_' + str(t_end) + '_dt_' + str(dt) \
    + '_ensem_' + str(n_ensem)).replace('.','p')
model_dir=os.path.join(sim_dir,model_dir_name)

# folder name for model with particular run param
model_param_dir=os.path.join(model_dir,model_param_dir_name)

# create folder for figure (one level up from data folder)
figure_dir=os.path.join(mother_dir, '../../figure/')
os.makedirs(figure_dir, exist_ok=True)
## folder for this suit of figures
plot_dir=os.path.join(figure_dir, sim_model)
os.makedirs(plot_dir, exist_ok=True)
# initialize figures (1: SAS pattern, 2: Fit param) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[183:234]
==fs_plot:[160:210]
scatt_settings='cat_' + method_cat + '_' + str(num_cat) + 'Q_' \
    + str(Q_range[0]) + '_' + str(Q_range[1]) + '_' + 'orien__' + str(num_orientation)
scatt_settings=scatt_settings.replace('.', 'p')

"""
read folder structure
"""

# folder structure
## mother folder name
### save length values as strings
### decimal points are replaced with p
length_a_str=str(length_a).replace('.','p')
length_b_str=str(length_a).replace('.','p')
length_c_str=str(length_a).replace('.','p')

### save num_cell values as strings
nx_str=str(nx)
ny_str=str(ny)
nz_str=str(nz)

### save element_order values as strings
el_order_str='lagrangian_' + str(el_order)

mother_dir_name = length_a_str+'_' + length_b_str+'_' + length_c_str\
      + '_' + nx_str + '_' + ny_str + '_' + nz_str + '_' + el_order_str
data_dir=os.path.join(working_dir, 'data')
mother_dir = os.path.join(data_dir, mother_dir_name)

# read structure info
data_file=os.path.join(mother_dir, 'structure/struct.h5')

# folder name for simulation
sim_dir=os.path.join(mother_dir, 'simulation')

# folder name for model
model_dir_name= (sim_model + '_tend_' + str(t_end) + '_dt_' + str(dt) \
    + '_ensem_' + str(n_ensem)).replace('.','p')
model_dir=os.path.join(sim_dir,model_dir_name)

# folder name for model with particular run param
model_param_dir=os.path.join(model_dir,model_param_dir_name)

# create folder for figure (one level up from data folder)
figure_dir=os.path.join(mother_dir, '../../figure/')
os.makedirs(figure_dir, exist_ok=True)
## folder for this suit of figures
plot_dir=os.path.join(figure_dir, sim_model)
os.makedirs(plot_dir, exist_ok=True)
# initialize figures (1: SAS pattern) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.ball.ball_gen:[140:173]
==phase_field_gen:[170:202]
    print(info_str + 'Executing sim_gen.py')
    script_path = os.path.join(script_dir, 'sim_gen.py')  # Full path of the script
    #working_dir = "."  # Directory to run the script in
    subprocess.run(["python", script_path], cwd=working_dir, stderr=subprocess.PIPE, check=True)
else:
    print(info_str + 'simulation not attempted')
# time counter end - simulation gen
toc_sim = time.perf_counter()
ttot_sim= round(toc_sim - tic_sim,3)
print(f'Time taken for assigning SLD values: {ttot_sim} s')
print('-------------------------------------------------')

print('-------------------------------------------------')
print(part_str + 'Calculating SAS pattern')
print('')
# time counter start - SAS calculation
tic_scatt = time.perf_counter()
if scatt_cal_run==1:
    # scatt_cal xml
    print(info_str + 'Generating scatt_cal.xml')
    xml_gen.scatt_cal_xml_write(xml_dir, num_cat, method_cat,
                                sassena_exe, mpi_procs, num_threads,
                                sig_file, scan_vec, Q_range,
                                num_points, num_orientation)

    # calculate scattering function
    print(info_str + 'Executing scatt_cal.py')
    script_path = os.path.join(script_dir, 'scatt_cal.py')  # Full path of the script
    #working_dir = "."  # Directory to run the script in
    subprocess.run(["python", script_path], cwd=working_dir, stderr=subprocess.PIPE, check=True)
else:
    print(info_str + 'Calculation of scattring function not attempted')
# time counter end - SAS calculation (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==fs_plot:[228:263]
==sld_grow_plot:[218:253]
    for j in range(n_ensem):
        idx_ensem=j
        # create ensemble dir
        ensem_dir_name=f'ensem{idx_ensem:0>3}'
        ensem_dir=os.path.join(t_dir, ensem_dir_name)

        # create scatt dir
        scatt_dir_name='scatt_cal_'+ scatt_settings
        scatt_dir=os.path.join(ensem_dir, scatt_dir_name)


        """
        read pseudo atom info from scatt_cal.h5
        """
        # read node sld
        # save pseudo atom info
        scatt_cal_dir_name='scatt_cal_' + scatt_settings
        scatt_cal_dir=os.path.join(ensem_dir, scatt_cal_dir_name)
        scatt_cal_data_file_name='scatt_cal.h5'
        scatt_cal_data_file=os.path.join(scatt_cal_dir, scatt_cal_data_file_name)
        scatt_cal_data=h5py.File(scatt_cal_data_file,'r')
        node_pos=scatt_cal_data['node_pos'][:]
        node_pos=np.array(node_pos)
        node_sld=scatt_cal_data['node_sld'][:]
        node_sld=np.array(node_sld)
        pseudo_pos=scatt_cal_data['pseudo_pos'][:]
        pseudo_pos=np.array(pseudo_pos)
        pseudo_b=scatt_cal_data['pseudo_b'][:]
        pseudo_b=np.array(pseudo_b)
        pseudo_b_cat_val=scatt_cal_data['pseudo_b_cat_val'][:]
        pseudo_b_cat_val=np.array(pseudo_b_cat_val)
        pseudo_b_cat_idx=scatt_cal_data['pseudo_b_cat_idx'][:]
        scatt_cal_data.close()

        # determine sld min and max for plotting (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[295:328]
==fs_plot:[286:319]
            img = ax.imshow(node_sld_3d[:,:,z_idx].T,
                             extent=[0, length_a, 0, length_b],
                               origin='lower', vmin=sld_min, vmax=sld_max, interpolation='bilinear')
            ## color bar
            cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
            cbar_label=r"Scattering length density (SLD) [$10^{-5} \cdot \mathrm{\AA}^{-2}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title
            title_text=" Cut at Z = {0} {1}".format(z_val, r"$\mathrm{\AA}$")
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            ## add mesh
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))

            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

            # plotting pseudo atoms
            ## cutting at z = z_val + length_z
            # cell_z= length_c/nz
            # z_val_pseudo=z_val+cell_z
            cut_frac=0.5
            pseudo_pos_3d=pseudo_pos.reshape((nx, ny, nz, 3))
            pseudo_b_3d=pseudo_b.reshape((nx, ny, nz)) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==fs_plot:[320:396]
==sld_grow_plot:[305:380]
            z_val_pseudo=pseudo_pos_3d[0, 0, z_idx_pseudo , 2]
            ## figure specification
            plot_file_name=f'pseudo_{sim_model}_{t_str}.pdf'
            plot_file=os.path.join(plot_dir,plot_file_name)
            fig, ax = plt.subplots(figsize=(5, 5))
            ## scatter plot
            pseudo_pos_x=pseudo_pos_3d[:,:,z_idx_pseudo,0]
            pseudo_pos_y=pseudo_pos_3d[:,:,z_idx_pseudo,1]
            pseudo_b_xy=pseudo_b_3d[:,:,z_idx_pseudo]
            img = ax.scatter(pseudo_pos_x, pseudo_pos_y, c=pseudo_b_xy, s=3, cmap='viridis')
            ## color bar
            cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
            cbar_label=r"Scattering length (b) [$10^{-5} \cdot \mathrm{\AA} = \mathrm{fm}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title
            title_text=" Cut at Z = {0} {1}".format(z_val_pseudo, r"$\mathrm{\AA}$")
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            # other formatting
            ax.set_aspect('equal')
            ax.set_xlim([0, length_a])
            ax.set_ylim([0, length_b])
            ## add mesh
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))
            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

            # plotting categorized pseudo atoms
            ## figure specification
            plot_file_name=f'pseudo_cat_{sim_model}_{t_str}.pdf'
            plot_file=os.path.join(plot_dir,plot_file_name)
            fig, ax = plt.subplots(figsize=(5, 5))
            ## scatter plot
            pseudo_b_cat_val_3d=pseudo_b_cat_val.reshape((nx, ny, nz))
            pseudo_b_cat_val_xy=pseudo_b_cat_val_3d[:,:,z_idx_pseudo]
            img = ax.scatter(pseudo_pos_x, pseudo_pos_y, c=pseudo_b_cat_val_xy, s=3, cmap='viridis')
            ## color bar
            cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
            cbar_label=r"Scattering length (b) [$10^{-5} \cdot \mathrm{\AA} = \mathrm{fm}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title
            title_text=" Cut at Z = {0} {1}".format(z_val_pseudo, r"$\mathrm{\AA}$")
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            # other formatting
            ax.set_aspect('equal')
            ax.set_xlim([0, length_a])
            ax.set_ylim([0, length_b])
            x_ticks_val=np.round(np.linspace(0, length_a, 5),2)
            ax.set_xticks(list(x_ticks_val))
            y_ticks_val=np.round(np.linspace(0, length_b, 5),2)
            ax.set_yticks(list(y_ticks_val))
            ## add mesh
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))
            plt.savefig(plot_file, format='pdf')
            plt.close(fig)
    # box geometry (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==fs_plot:[290:322]
==phase_field_plot:[253:287]
                cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
                cbar_label=r"Scattering length density (SLD) [$10^{-5} \cdot \mathrm{\AA}^{-2}$]"
                cbar.set_label(cbar_label, labelpad=10)
                ## plot title
                title_text=" Cut at Z = {0} {1}".format(z_val, r"$\mathrm{\AA}$")
                ax.set_title(title_text)
                # labels
                ax.set_xlabel(r'X [$\mathrm{\AA}$]')
                ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
                ## add mesh
                cell_x=length_a/nx
                cell_y=length_a/ny
                for idx1 in range(nx):
                    for idx2 in range(ny):
                        rect_center_x=idx1*cell_x
                        rect_center_y=idx2*cell_y
                        ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                                edgecolor='k', facecolor='none', linewidth=0.5))


                # save figure
                plt.savefig(plot_file, format='pdf')
                plt.close(fig)

                # plotting pseudo atoms
                ## cutting at z = z_val + length_z
                # cell_z= length_c/nz
                # z_val_pseudo=z_val+cell_z
                cut_frac=0.5
                pseudo_pos_3d=pseudo_pos.reshape((nx, ny, nz, 3))
                pseudo_b_3d=pseudo_b.reshape((nx, ny, nz))
                z_idx_pseudo= nz//2-1 #z_idx-1
                z_val_pseudo=pseudo_pos_3d[0, 0, z_idx_pseudo , 2]
                ## figure specification (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[183:231]
==sld_grow_plot_joss:[150:196]
scatt_settings='cat_' + method_cat + '_' + str(num_cat) + 'Q_' \
    + str(Q_range[0]) + '_' + str(Q_range[1]) + '_' + 'orien__' + str(num_orientation)
scatt_settings=scatt_settings.replace('.', 'p')

"""
read folder structure
"""

# folder structure
## mother folder name
### save length values as strings
### decimal points are replaced with p
length_a_str=str(length_a).replace('.','p')
length_b_str=str(length_a).replace('.','p')
length_c_str=str(length_a).replace('.','p')

### save num_cell values as strings
nx_str=str(nx)
ny_str=str(ny)
nz_str=str(nz)

### save element_order values as strings
el_order_str='lagrangian_' + str(el_order)

mother_dir_name = length_a_str+'_' + length_b_str+'_' + length_c_str\
      + '_' + nx_str + '_' + ny_str + '_' + nz_str + '_' + el_order_str
data_dir=os.path.join(working_dir, 'data')
mother_dir = os.path.join(data_dir, mother_dir_name)

# read structure info
data_file=os.path.join(mother_dir, 'structure/struct.h5')

# folder name for simulation
sim_dir=os.path.join(mother_dir, 'simulation')

### model xml entries ###
# folder name for model
model_dir_name= (sim_model + '_tend_' + str(t_end) + '_dt_' + str(dt) \
    + '_ensem_' + str(n_ensem)).replace('.','p')
model_dir=os.path.join(sim_dir,model_dir_name)

# folder name for model with particular run param
model_param_dir=os.path.join(model_dir,model_param_dir_name)

# create folder for figure (one level up from data folder)
figure_dir=os.path.join(mother_dir, '../../figure/')
os.makedirs(figure_dir, exist_ok=True)
## folder for this suit of figures (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.ball.ball_plot:[253:284]
==models.box.box_plot:[273:305]
            cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
            cbar_label=r"Scattering length density (SLD) [$10^{-5} \cdot \mathrm{\AA}^{-2}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title
            title_text=" Cut at Z = {0} {1}".format(z_val, r"$\mathrm{\AA}$")
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            ## add mesh
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))

            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

            # plotting pseudo atoms
            ## cutting at z = z_val + length_z
            # cell_z= length_c/nz
            # z_val_pseudo=z_val+cell_z
            cut_frac=0.5
            pseudo_pos_3d=pseudo_pos.reshape((nx, ny, nz, 3))
            pseudo_b_3d=pseudo_b.reshape((nx, ny, nz))
            z_idx_pseudo= nz//2-1 # z_idx-1
            z_val_pseudo=pseudo_pos_3d[0, 0, z_idx_pseudo , 2]
            ## figure specification (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[241:273]
==sld_grow_plot:[221:253]
        ensem_dir_name=f'ensem{idx_ensem:0>3}'
        ensem_dir=os.path.join(t_dir, ensem_dir_name)

        # create scatt dir
        scatt_dir_name='scatt_cal_'+ scatt_settings
        scatt_dir=os.path.join(ensem_dir, scatt_dir_name)


        """
        read pseudo atom info from scatt_cal.h5
        """
        # read node sld
        # save pseudo atom info
        scatt_cal_dir_name='scatt_cal_' + scatt_settings
        scatt_cal_dir=os.path.join(ensem_dir, scatt_cal_dir_name)
        scatt_cal_data_file_name='scatt_cal.h5'
        scatt_cal_data_file=os.path.join(scatt_cal_dir, scatt_cal_data_file_name)
        scatt_cal_data=h5py.File(scatt_cal_data_file,'r')
        node_pos=scatt_cal_data['node_pos'][:]
        node_pos=np.array(node_pos)
        node_sld=scatt_cal_data['node_sld'][:]
        node_sld=np.array(node_sld)
        pseudo_pos=scatt_cal_data['pseudo_pos'][:]
        pseudo_pos=np.array(pseudo_pos)
        pseudo_b=scatt_cal_data['pseudo_b'][:]
        pseudo_b=np.array(pseudo_b)
        pseudo_b_cat_val=scatt_cal_data['pseudo_b_cat_val'][:]
        pseudo_b_cat_val=np.array(pseudo_b_cat_val)
        pseudo_b_cat_idx=scatt_cal_data['pseudo_b_cat_idx'][:]
        scatt_cal_data.close()

        # determine sld min and max for plotting (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.ball.ball_plot:[149:188]
==phase_field_plot:[146:185]
length_a_str=str(length_a).replace('.','p')
length_b_str=str(length_a).replace('.','p')
length_c_str=str(length_a).replace('.','p')

### save num_cell values as strings
nx_str=str(nx)
ny_str=str(ny)
nz_str=str(nz)

### save element_order values as strings
el_order_str='lagrangian_' + str(el_order)


mother_dir_name = length_a_str+'_' + length_b_str+'_' + length_c_str\
      + '_' + nx_str + '_' + ny_str+'_' + nz_str + '_' + el_order_str
data_dir=os.path.join(working_dir, 'data')
mother_dir = os.path.join(data_dir, mother_dir_name)

# read structure info
data_file=os.path.join(mother_dir, 'structure/struct.h5')

# folder name for simulation
sim_dir=os.path.join(mother_dir, 'simulation')

# folder name for model
model_dir_name= (sim_model + '_tend_' + str(t_end) + '_dt_' + str(dt) \
    + '_ensem_' + str(n_ensem)).replace('.','p')
model_dir=os.path.join(sim_dir,model_dir_name)

# folder name for model with particular run param
model_param_dir=os.path.join(model_dir,model_param_dir_name)

# create folder for figure (one level up from data folder)
figure_dir=os.path.join(mother_dir, '../../figure/')
os.makedirs(figure_dir, exist_ok=True)
## folder for this suit of figures
plot_dir=os.path.join(figure_dir, sim_model)
os.makedirs(plot_dir, exist_ok=True)
 (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.gg.gg_plot:[314:349]
==phase_field_plot:[288:324]
            plot_file=os.path.join(plot_dir,plot_file_name)
            fig, ax = plt.subplots(figsize=(5, 5))
            ## scatter plot
            pseudo_pos_x=pseudo_pos_3d[:,:,z_idx_pseudo,0]
            pseudo_pos_y=pseudo_pos_3d[:,:,z_idx_pseudo,1]
            pseudo_b_xy=pseudo_b_3d[:,:,z_idx_pseudo]
            img = ax.scatter(pseudo_pos_x, pseudo_pos_y, c=pseudo_b_xy, s=3, cmap='viridis')
            ## color bar
            cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
            cbar_label=r"Scattering length (b) [$10^{-5} \cdot \mathrm{\AA} = \mathrm{fm}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title
            title_text=" Cut at Z = {0} {1}".format(z_val_pseudo, r"$\mathrm{\AA}$")
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            # other formatting
            ax.set_aspect('equal')
            ax.set_xlim([0, length_a])
            ax.set_ylim([0, length_b])
            ## add mesh
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))
            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

            # plotting categorized pseudo atoms
            ## figure specification (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==fs_plot:[323:358]
==models.box.box_plot:[306:341]
            plot_file=os.path.join(plot_dir,plot_file_name)
            fig, ax = plt.subplots(figsize=(5, 5))
            ## scatter plot
            pseudo_pos_x=pseudo_pos_3d[:,:,z_idx_pseudo,0]
            pseudo_pos_y=pseudo_pos_3d[:,:,z_idx_pseudo,1]
            pseudo_b_xy=pseudo_b_3d[:,:,z_idx_pseudo]
            img = ax.scatter(pseudo_pos_x, pseudo_pos_y, c=pseudo_b_xy, s=3, cmap='viridis')
            ## color bar
            cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
            cbar_label=r"Scattering length (b) [$10^{-5} \cdot \mathrm{\AA} = \mathrm{fm}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title
            title_text=" Cut at Z = {0} {1}".format(z_val_pseudo, r"$\mathrm{\AA}$")
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            # other formatting
            ax.set_aspect('equal')
            ax.set_xlim([0, length_a])
            ax.set_ylim([0, length_b])
            ## add mesh
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))
            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

            # plotting categorized pseudo atoms
            ## figure specification (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_plot:[316:345]
==phase_field_plot:[253:284]
                cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
                cbar_label=r"Scattering length density (SLD) [$10^{-5} \cdot \mathrm{\AA}^{-2}$]"
                cbar.set_label(cbar_label, labelpad=10)
                ## plot title
                title_text=" Cut at Z = {0} {1}".format(z_val, r"$\mathrm{\AA}$")
                ax.set_title(title_text)
                # labels
                ax.set_xlabel(r'X [$\mathrm{\AA}$]')
                ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
                ## add mesh
                cell_x=length_a/nx
                cell_y=length_a/ny
                for idx1 in range(nx):
                    for idx2 in range(ny):
                        rect_center_x=idx1*cell_x
                        rect_center_y=idx2*cell_y
                        ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                                edgecolor='k', facecolor='none', linewidth=0.5))


                # save figure
                plt.savefig(plot_file, format='pdf')
                plt.close(fig)

                # plotting pseudo atoms
                ## cutting at z = z_val + length_z
                # cell_z= length_c/nz
                # z_val_pseudo=z_val+cell_z
                cut_frac=0.5
                pseudo_pos_3d=pseudo_pos.reshape((nx, ny, nz, 3))
                pseudo_b_3d=pseudo_b.reshape((nx, ny, nz)) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_plot:[349:384]
==models.ball.ball_plot:[285:320]
            plot_file=os.path.join(plot_dir,plot_file_name)
            fig, ax = plt.subplots(figsize=(5, 5))
            ## scatter plot
            pseudo_pos_x=pseudo_pos_3d[:,:,z_idx_pseudo,0]
            pseudo_pos_y=pseudo_pos_3d[:,:,z_idx_pseudo,1]
            pseudo_b_xy=pseudo_b_3d[:,:,z_idx_pseudo]
            img = ax.scatter(pseudo_pos_x, pseudo_pos_y, c=pseudo_b_xy, s=3, cmap='viridis')
            ## color bar
            cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
            cbar_label=r"Scattering length (b) [$10^{-5} \cdot \mathrm{\AA} = \mathrm{fm}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title
            title_text=" Cut at Z = {0} {1}".format(z_val_pseudo, r"$\mathrm{\AA}$")
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            # other formatting
            ax.set_aspect('equal')
            ax.set_xlim([0, length_a])
            ax.set_ylim([0, length_b])
            ## add mesh
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))
            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

            # plotting categorized pseudo atoms
            ## figure specification (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[299:328]
==models.ball.ball_plot:[253:281]
            cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
            cbar_label=r"Scattering length density (SLD) [$10^{-5} \cdot \mathrm{\AA}^{-2}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title
            title_text=" Cut at Z = {0} {1}".format(z_val, r"$\mathrm{\AA}$")
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            ## add mesh
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))

            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

            # plotting pseudo atoms
            ## cutting at z = z_val + length_z
            # cell_z= length_c/nz
            # z_val_pseudo=z_val+cell_z
            cut_frac=0.5
            pseudo_pos_3d=pseudo_pos.reshape((nx, ny, nz, 3))
            pseudo_b_3d=pseudo_b.reshape((nx, ny, nz)) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==scatt_cal:[135:164]
==sim_gen:[104:134]
length_a_str=str(length_a).replace('.','p')
length_b_str=str(length_a).replace('.','p')
length_c_str=str(length_a).replace('.','p')

### save num_cell values as strings
nx_str=str(nx)
ny_str=str(ny)
nz_str=str(nz)

struct_folder_name = (length_a_str + '_' + length_b_str + '_' + length_c_str
                       + '_' + nx_str + '_' + ny_str + '_' + nz_str)

# save elemnt type as string
if el_type=='lagrangian':
    el_order_str=str(el_order)
    struct_folder_name += '_' + el_type + '_' + el_order_str


sim_dir=os.path.join('./data/', struct_folder_name +'/simulation')
os.makedirs(sim_dir, exist_ok=True)


# read structure info
data_filename=os.path.join(sim_dir,'../structure/struct.h5')
nodes, cells, con, mesh = sg.mesh_read(data_filename)

# create folder for model
model_dir_name= (sim_model + '_tend_' + str(t_end) + '_dt_' + str(dt) \
    + '_ensem_' + str(n_ensem)).replace('.','p')
model_dir=os.path.join(sim_dir,model_dir_name) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_gen:[31:66]
==models.box.box_gen:[31:64]
lib_dir = os.path.abspath(os.path.join(os.path.dirname(__file__), '../..'))
# add .. in path
sys.path.append(lib_dir)
# lib imports
from lib import xml_gen # pylint: disable=wrong-import-position

# ignore warnings
warnings.filterwarnings("ignore")

##############
# input values
##############
# script dir and working dir
script_dir = "src"  # Full path of the script
working_dir = "."  # Directory to run the script in


### struct gen ###
xml_dir='./xml'
length_a=40.
length_b=40.
length_c=40.
nx=40
ny=40
nz=40
el_type='lagrangian'
el_order=1
update_val=True
plt_node=False
plt_cell=False
plt_mesh=False

### sim gen ### (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_gen:[31:66]
==models.ball.ball_gen:[31:65]
lib_dir = os.path.abspath(os.path.join(os.path.dirname(__file__), '../..'))
# add .. in path
sys.path.append(lib_dir)
# lib imports
from lib import xml_gen # pylint: disable=wrong-import-position


# ignore warnings
warnings.filterwarnings("ignore")

##############
# input values
##############

# script dir and working dir
script_dir = "src"  # Full path of the script
working_dir = "."  # Directory to run the script in


### struct gen ###
xml_dir='./xml'
length_a=40.
length_b=40.
length_c=40.
nx=40
ny=40
nz=40
el_type='lagrangian'
el_order=1
update_val=True
plt_node=False
plt_cell=False
plt_mesh=False

### sim gen ### (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_plot:[130:164]
==bib_plot:[115:151]
        psi_lim=np.pi
        alpha_lim=np.pi/2
        # Amplitude unit (\AA^3 * 10^-5 \AA^-2)^2 = 10^-10 \AA^2
        Aq_arr[q_idx]=(1/psi_lim)*gauss_legendre_double_integrate(func,[0, alpha_lim],[0, psi_lim],76)
    Iq_arr = scale*Aq_arr + bg # Intensity unit 10^-10 \AA^2
    return Iq_arr, q_arr

##########################
# read input from xml file
##########################

### file locations ###
# xml location
xml_folder='./xml/'
# script dir and working dir
script_dir = "src"  # Full path of the script
working_dir = "."  # Directory to run the script in


### struct gen ###
# box side lengths (float values)
length_a=40.
length_b=40.
length_c=40.
# number of cells in each direction (int values)
nx=40
ny=40
nz=40
# element details
el_type='lagrangian'
el_order=1
# calculate mid point of structure (simulation box)
mid_point=np.array([length_a/2, length_b/2, length_c/2])

### sim gen ###
# model name (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.ball.ball_plot:[128:163]
==models.gg.gg_plot:[147:178]
method_cat='extend'
sig_file='signal.h5'
scan_vec=np.array([1, 0, 0])
Q_range=np.array([0., 1.]) # mention integers as float
num_points=100
num_orientation=10
# scatt settengs
scatt_settings='cat_' + method_cat + '_' + str(num_cat) + 'Q_' \
    + str(Q_range[0]) + '_' + str(Q_range[1]) + '_' + 'orien__' + str(num_orientation)
scatt_settings=scatt_settings.replace('.', 'p')

"""
read folder structure
"""
# folder structure
## mother folder name
### save length values as strings
### decimal points are replaced with p
length_a_str=str(length_a).replace('.','p')
length_b_str=str(length_a).replace('.','p')
length_c_str=str(length_a).replace('.','p')

### save num_cell values as strings
nx_str=str(nx)
ny_str=str(ny)
nz_str=str(nz)

### save element_order values as strings
el_order_str='lagrangian_' + str(el_order)

mother_dir_name = length_a_str+'_' + length_b_str+'_' + length_c_str\ (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[209:238]
==phase_field_plot:[161:190]
data_dir=os.path.join(working_dir, 'data')
mother_dir = os.path.join(data_dir, mother_dir_name)

# read structure info
data_file=os.path.join(mother_dir, 'structure/struct.h5')

# folder name for simulation
sim_dir=os.path.join(mother_dir, 'simulation')

### model xml entries ###
# folder name for model
model_dir_name= (sim_model + '_tend_' + str(t_end) + '_dt_' + str(dt) \
    + '_ensem_' + str(n_ensem)).replace('.','p')
model_dir=os.path.join(sim_dir,model_dir_name)

# folder name for model with particular run param
model_param_dir=os.path.join(model_dir,model_param_dir_name)

# create folder for figure (one level up from data folder)
figure_dir=os.path.join(mother_dir, '../../figure/')
os.makedirs(figure_dir, exist_ok=True)
## folder for this suit of figures
plot_dir=os.path.join(figure_dir, sim_model)
os.makedirs(plot_dir, exist_ok=True)

for i, t in enumerate(t_arr):
    # time_dir name
    t_dir_name=f't{i:0>3}'
    t_dir=os.path.join(model_param_dir, t_dir_name) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[58:88]
==models.box.box_plot:[47:74]
    zusammen=[a,b,c]
    zusammen.sort()
    return zusammen[0], zusammen[1], zusammen[2]

def gauss_legendre_double_integrate(func, domain1, domain2, deg):
    """
    function desc:
    numerical integration using gauss points
    """
    x, w = np.polynomial.legendre.leggauss(deg)
    xgrid, ygrid=np.meshgrid(x,x)
    x=xgrid.reshape((1,np.size(xgrid)))
    y=ygrid.reshape((1,np.size(ygrid)))
    wx, wy=np.meshgrid(w,w)
    w1=wx.reshape((1,np.size(wx)))
    w2=wy.reshape((1,np.size(wy)))
    s1 = (domain1[1] - domain1[0])/2
    a1 = (domain1[1] + domain1[0])/2
    s2 = (domain2[1] - domain2[0])/2
    a2 = (domain2[1] + domain2[0])/2
    return np.sum(s1*s2*w1*w2*func(s1*x + a1,s2*y + a2))

def box (qmax,qmin,Npts,scale,bg,sld,sld_sol,len_x,len_y,len_z):
    """
    function desc:
    analytical SAS pattern of parallelepiped
    """ (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==sld_grow_plot:[380:409]
==sld_grow_plot_joss:[218:247]
    vol_box=length_a*length_b*length_c

    # volume for normalization
    vol_norm=vol_box

    # numerical intensity
    ## read I vs Q signal file
    Iq_data_file_name=f'Iq_{scatt_settings}.h5'
    Iq_data_file=os.path.join(t_dir,Iq_data_file_name)
    Iq_data=h5py.File(Iq_data_file,'r')
    Iq_num_raw=Iq_data['Iq'][:] # unit fm^2
    Iq_num=Iq_num_raw/vol_norm*10**2 # unit (fm^2 / \AA^3) * 10^2 = cm^-1
    q_num=Iq_data['Q'][:]
    Iq_data.close()

    # fit radius w.r.t. numerical intensity
    popt, pcov = curve_fit(fit_func_sld_grow, q_num, Iq_num_raw) # pylint: disable=unbalanced-tuple-unpacking
    sld_fit[i]=popt[0]+sld_out

    # ananlytical intensity
    ## Intensity unit 10^-10 \AA^2
    Iq_ana_raw,q_ana= ball(qmax=np.max(q_num),qmin=np.min(q_num),Npts=100,
                scale=1,bg=0,sld=sld_fit[i], sld_sol=sld_out, rad=rad_grain)
    ## Normalize by volume
    ## (Before * 10**2) Intensity unit 10^-10 \AA^-1 = 10 ^-2 cm^-1
    ## (after * 10**2) Intensity unit cm^-1
    Iq_ana = (Iq_ana_raw / vol_norm) * 10**2

    # plot scatt patern for all time steps (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[119:151]
==models.box.box_plot:[94:126]
    Iq_arr = scale*Aq_arr + bg # Intensity unit 10^-10 \AA^2
    return Iq_arr, q_arr

##########################
# read input from xml file
##########################

### file locations ###
# xml location
xml_folder='./xml/'
# script dir and working dir
script_dir = "src"  # Full path of the script
working_dir = "."  # Directory to run the script in


### struct gen ###
# box side lengths (float values)
length_a=40.
length_b=40.
length_c=40.
# number of cells in each direction (int values)
nx=40
ny=40
nz=40
# element details
el_type='lagrangian'
el_order=1
# calculate mid point of structure (simulation box)
mid_point=np.array([length_a/2, length_b/2, length_c/2])

### sim gen ###
# model name (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.ball.ball_plot:[49:79]
==models.gg.gg_plot:[50:81]
    else:
        y = (np.sin(x)-x*np.cos(x))/x**2
    return y

def ball (qmax,qmin,Npts,scale,bg,sld,sld_sol,rad):
    """
    function desc:
    analytical SAS pattern of sphere
    """
    vol=(4/3)*np.pi*rad**3
    # SLD unit 10^-5 \AA^-2
    del_rho=sld-sld_sol
    q_arr=np.linspace(qmin,qmax,Npts)
    FormFactor=np.zeros(len(q_arr))
    for q_idx, q_cur in enumerate(q_arr):
        if q_cur==0:
            # Form factor unit 10^-5 \AA
            FormFactor[q_idx]=vol*del_rho
        else:
            # Form factor unit 10^-5 \AA
            FormFactor[q_idx]=3*vol*del_rho*J1(q_cur*rad)/(q_cur*rad)
    # Intensity unit 10^-10 \AA^2
    Iq_arr = (scale)*np.abs(FormFactor)**2+bg
    return Iq_arr, q_arr

def fit_func_gg(q_in, rad_opt):
    """
    function desc:
    fit function for sphere
    """
    # pylint: disable=unused-variable (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==scatt_cal:[35:67]
==struct_gen:[31:62]
lib_dir = os.path.abspath(os.path.join(os.path.dirname(__file__), '..'))
# add .. in path
sys.path.append(lib_dir)
# lib imports
from lib import struct_gen as sg # pylint: disable=wrong-import-position

#timer counter initial
tic = time.perf_counter()

##########################
# read input from xml file
##########################

xml_folder='./xml/'

struct_xml=os.path.join(xml_folder, 'struct.xml')

tree=ET.parse(struct_xml)
root = tree.getroot()

# box side lengths
length_a=float(root.find('lengths').find('x').text)
length_b=float(root.find('lengths').find('y').text)
length_c=float(root.find('lengths').find('z').text)

# number of cells in each direction
nx=int(root.find('num_cell').find('x').text)
ny=int(root.find('num_cell').find('y').text)
nz=int(root.find('num_cell').find('z').text)

# element type (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[368:405]
==sld_grow_plot:[344:380]
            plot_file=os.path.join(plot_dir,plot_file_name)
            fig, ax = plt.subplots(figsize=(5, 5))
            ## scatter plot
            pseudo_b_cat_val_3d=pseudo_b_cat_val.reshape((nx, ny, nz))
            pseudo_b_cat_val_xy=pseudo_b_cat_val_3d[:,:,z_idx_pseudo]
            img = ax.scatter(pseudo_pos_x, pseudo_pos_y, c=pseudo_b_cat_val_xy, s=3, cmap='viridis')
            ## color bar
            cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
            cbar_label=r"Scattering length (b) [$10^{-5} \cdot \mathrm{\AA} = \mathrm{fm}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title
            title_text=" Cut at Z = {0} {1}".format(z_val_pseudo, r"$\mathrm{\AA}$")
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            # other formatting
            ax.set_aspect('equal')
            ax.set_xlim([0, length_a])
            ax.set_ylim([0, length_b])
            x_ticks_val=np.round(np.linspace(0, length_a, 5),2)
            ax.set_xticks(list(x_ticks_val))
            y_ticks_val=np.round(np.linspace(0, length_b, 5),2)
            ax.set_yticks(list(y_ticks_val))
            ## add mesh
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))
            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

    # volume for normalization (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[368:412]
==fs_plot:[359:403]
            plot_file=os.path.join(plot_dir,plot_file_name)
            fig, ax = plt.subplots(figsize=(5, 5))
            ## scatter plot
            pseudo_b_cat_val_3d=pseudo_b_cat_val.reshape((nx, ny, nz))
            pseudo_b_cat_val_xy=pseudo_b_cat_val_3d[:,:,z_idx_pseudo]
            img = ax.scatter(pseudo_pos_x, pseudo_pos_y, c=pseudo_b_cat_val_xy, s=3, cmap='viridis')
            ## color bar
            cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
            cbar_label=r"Scattering length (b) [$10^{-5} \cdot \mathrm{\AA} = \mathrm{fm}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title
            title_text=" Cut at Z = {0} {1}".format(z_val_pseudo, r"$\mathrm{\AA}$")
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            # other formatting
            ax.set_aspect('equal')
            ax.set_xlim([0, length_a])
            ax.set_ylim([0, length_b])
            x_ticks_val=np.round(np.linspace(0, length_a, 5),2)
            ax.set_xticks(list(x_ticks_val))
            y_ticks_val=np.round(np.linspace(0, length_b, 5),2)
            ax.set_yticks(list(y_ticks_val))
            ## add mesh
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))
            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

    # volume for normalization
    vol_norm=length_a*length_b*length_c # sim box volumr

    # numerical intensity
    ## read I vs Q signal file
    Iq_data_file_name=f'Iq_{scatt_settings}.h5'
    Iq_data_file=os.path.join(t_dir,Iq_data_file_name)
    Iq_data=h5py.File(Iq_data_file,'r') (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_plot:[385:436]
==bib_plot:[368:419]
            plot_file=os.path.join(plot_dir,plot_file_name)
            fig, ax = plt.subplots(figsize=(5, 5))
            ## scatter plot
            pseudo_b_cat_val_3d=pseudo_b_cat_val.reshape((nx, ny, nz))
            pseudo_b_cat_val_xy=pseudo_b_cat_val_3d[:,:,z_idx_pseudo]
            img = ax.scatter(pseudo_pos_x, pseudo_pos_y, c=pseudo_b_cat_val_xy, s=3, cmap='viridis')
            ## color bar
            cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
            cbar_label=r"Scattering length (b) [$10^{-5} \cdot \mathrm{\AA} = \mathrm{fm}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title
            title_text=" Cut at Z = {0} {1}".format(z_val_pseudo, r"$\mathrm{\AA}$")
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            # other formatting
            ax.set_aspect('equal')
            ax.set_xlim([0, length_a])
            ax.set_ylim([0, length_b])
            x_ticks_val=np.round(np.linspace(0, length_a, 5),2)
            ax.set_xticks(list(x_ticks_val))
            y_ticks_val=np.round(np.linspace(0, length_b, 5),2)
            ax.set_yticks(list(y_ticks_val))
            ## add mesh
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))
            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

    # volume for normalization
    vol_norm=length_a*length_b*length_c # vol box

    # numerical intensity
    ## read I vs Q signal file
    Iq_data_file_name=f'Iq_{scatt_settings}.h5'
    Iq_data_file=os.path.join(t_dir,Iq_data_file_name)
    Iq_data=h5py.File(Iq_data_file,'r')
    Iq=Iq_data['Iq'][:] # unit fm^2
    Iq=Iq/vol_norm*10**2 # unit (fm^2 / \AA^3) * 10^2 = cm^-1
    q=Iq_data['Q'][:]
    Iq_data.close()

    # ananlytical intensity
    ## Intensity unit 10^-10 \AA^2 (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.ball.ball_plot:[133:163]
==sld_grow_plot:[149:176]
num_points=100
num_orientation=10
# scatt settengs
scatt_settings='cat_' + method_cat + '_' + str(num_cat) + 'Q_' \
    + str(Q_range[0]) + '_' + str(Q_range[1]) + '_' + 'orien__' + str(num_orientation)
scatt_settings=scatt_settings.replace('.', 'p')


#######################
# read folder structure
#######################

# folder structure
## mother folder name
### save length values as strings
### decimal points are replaced with p
length_a_str=str(length_a).replace('.','p')
length_b_str=str(length_a).replace('.','p')
length_c_str=str(length_a).replace('.','p')

### save num_cell values as strings
nx_str=str(nx)
ny_str=str(ny)
nz_str=str(nz)

### save element_order values as strings
el_order_str='lagrangian_' + str(el_order)


mother_dir_name = length_a_str+'_' + length_b_str+'_' + length_c_str\ (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.ball.ball_plot:[329:346]
==phase_field_plot:[334:352]
                cbar_label=r"Scattering length (b) [$10^{-5} \cdot \mathrm{\AA} = \mathrm{fm}$]"
                cbar.set_label(cbar_label, labelpad=10)
                ## plot title
                title_text=" Cut at Z = {0} {1}".format(z_val_pseudo, r"$\mathrm{\AA}$")
                ax.set_title(title_text)
                # labels
                ax.set_xlabel(r'X [$\mathrm{\AA}$]')
                ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
                # other formatting
                ax.set_aspect('equal')
                ax.set_xlim([0, length_a])
                ax.set_ylim([0, length_b])
                x_ticks_val=np.round(np.linspace(0, length_a, 5),2)
                ax.set_xticks(list(x_ticks_val))
                y_ticks_val=np.round(np.linspace(0, length_b, 5),2)
                ax.set_yticks(list(y_ticks_val))

                # cut aspet inset (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.ball.ball_gen:[173:188]
==phase_field_gen:[204:221]
toc_scatt = time.perf_counter()
ttot_scatt= round(toc_scatt - tic_scatt,3)
print(f'Time taken for calculating SAS pattern: {ttot_scatt} s')
print('-------------------------------------------------')

# Time satistics
print('')
print('-------------------------------------------------')
print('Time statistics')
print('-------------------------------------------------')
print(f'Mesh generation :{ttot_sg} s')
print(f'SLD assign      :{ttot_sim} s')
print(f'SAS calculation :{ttot_scatt} s')
print(f'Total           :{ttot_sg + ttot_sim + ttot_scatt} s')
print('-------------------------------------------------') (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==scatt_cal:[114:135]
==sig_eff_cal:[104:118]
signal_file=root.find('scatt_cal').find('sig_file').text
resolution_num=int(root.find('scatt_cal').find('num_orientation').text)
start_length=float(root.find('scatt_cal').find('Q_start').text)
end_length=float(root.find('scatt_cal').find('Q_end').text)
num_points=int(root.find('scatt_cal').find('num_points').text)
scan_vec_x=float(root.find('scatt_cal').find('scan_vec').find('x').text)
scan_vec_y=float(root.find('scatt_cal').find('scan_vec').find('y').text)
scan_vec_z=float(root.find('scatt_cal').find('scan_vec').find('z').text)
scan_vector=[scan_vec_x, scan_vec_y, scan_vec_z]
scatt_settings='cat_' + method_cat + '_' + str(num_cat) + 'Q_' \
    + str(start_length) + '_' + str(end_length) + '_' + 'orien_' + '_' + str(resolution_num)
scatt_settings=scatt_settings.replace('.', 'p')

### sigeff xml ### (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==fs_plot:[186:210]
==phase_field_plot:[161:185]
data_dir=os.path.join(working_dir, 'data')
mother_dir = os.path.join(data_dir, mother_dir_name)

# read structure info
data_file=os.path.join(mother_dir, 'structure/struct.h5')

# folder name for simulation
sim_dir=os.path.join(mother_dir, 'simulation')

# folder name for model
model_dir_name= (sim_model + '_tend_' + str(t_end) + '_dt_' + str(dt) \
    + '_ensem_' + str(n_ensem)).replace('.','p')
model_dir=os.path.join(sim_dir,model_dir_name)

# folder name for model with particular run param
model_param_dir=os.path.join(model_dir,model_param_dir_name)

# create folder for figure (one level up from data folder)
figure_dir=os.path.join(mother_dir, '../../figure/')
os.makedirs(figure_dir, exist_ok=True)
## folder for this suit of figures
plot_dir=os.path.join(figure_dir, sim_model)
os.makedirs(plot_dir, exist_ok=True)
# initialize figures (1: SAS pattern) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[128:151]
==models.gg.gg_plot:[93:120]
xml_folder='./xml/'
# script dir and working dir
script_dir = "src"  # Full path of the script
working_dir = "."  # Directory to run the script in

############
# Input data
############

### struct gen ###
# box side lengths (float values)
length_a=40.
length_b=40.
length_c=40.
# number of cells in each direction (int values)
nx=40
ny=40
nz=40
# element details
el_type='lagrangian'
el_order=1
# calculate mid point of structure (simulation box)
mid_point=np.array([length_a/2, length_b/2, length_c/2])


### sim gen ###
# model name (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[209:234]
==models.ball.ball_plot:[164:188]
data_dir=os.path.join(working_dir, 'data')
mother_dir = os.path.join(data_dir, mother_dir_name)

# read structure info
data_file=os.path.join(mother_dir, 'structure/struct.h5')

# folder name for simulation
sim_dir=os.path.join(mother_dir, 'simulation')

### model xml entries ###
# folder name for model
model_dir_name= (sim_model + '_tend_' + str(t_end) + '_dt_' + str(dt) \
    + '_ensem_' + str(n_ensem)).replace('.','p')
model_dir=os.path.join(sim_dir,model_dir_name)

# folder name for model with particular run param
model_param_dir=os.path.join(model_dir,model_param_dir_name)

# create folder for figure (one level up from data folder)
figure_dir=os.path.join(mother_dir, '../../figure/')
os.makedirs(figure_dir, exist_ok=True)
## folder for this suit of figures
plot_dir=os.path.join(figure_dir, sim_model)
os.makedirs(plot_dir, exist_ok=True)
 (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==scatt_cal:[135:151]
==struct_gen:[89:106]
length_a_str=str(length_a).replace('.','p')
length_b_str=str(length_a).replace('.','p')
length_c_str=str(length_a).replace('.','p')

### save num_cell values as strings
nx_str=str(nx)
ny_str=str(ny)
nz_str=str(nz)
struct_folder_name = (length_a_str + '_' + length_b_str + '_' + length_c_str
                       + '_' + nx_str + '_' + ny_str + '_' + nz_str)
# save elemnt type as string
if el_type=='lagrangian':
    el_order_str=str(el_order)
    struct_folder_name += '_' + el_type + '_' + el_order_str

 (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==sld_grow_plot:[199:218]
==sld_grow_plot_joss:[197:218]
os.makedirs(plot_dir, exist_ok=True)

# initialize fit_params (radius)
sld_fit=np.zeros_like(t_arr)
sld_ana=sld_in_0+t_arr*(sld_in_end-sld_in_0)/t_end

# initialize fit_params (1: radius, 2: NA)
fig_scatt_all, ax_scatt_all = plt.subplots(figsize=(7, 5))
fig_fit_all, ax_fit_all = plt.subplots(figsize=(7, 5))

# color scheme
cmap_rainbow=cm.get_cmap('rainbow')
color_rainbow = cmap_rainbow(np.linspace(0, 1, len(t_arr)))

for i,t in enumerate(t_arr):
    t_str=str(t).replace('.','p')
    # time_dir name
    t_dir_name=f't{i:0>3}'
    t_dir=os.path.join(model_param_dir, t_dir_name) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[183:208]
==models.ball.ball_plot:[136:163]
scatt_settings='cat_' + method_cat + '_' + str(num_cat) + 'Q_' \
    + str(Q_range[0]) + '_' + str(Q_range[1]) + '_' + 'orien__' + str(num_orientation)
scatt_settings=scatt_settings.replace('.', 'p')

"""
read folder structure
"""

# folder structure
## mother folder name
### save length values as strings
### decimal points are replaced with p
length_a_str=str(length_a).replace('.','p')
length_b_str=str(length_a).replace('.','p')
length_c_str=str(length_a).replace('.','p')

### save num_cell values as strings
nx_str=str(nx)
ny_str=str(ny)
nz_str=str(nz)

### save element_order values as strings
el_order_str='lagrangian_' + str(el_order)

mother_dir_name = length_a_str+'_' + length_b_str+'_' + length_c_str\ (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==phase_field_plot:[357:369]
==sld_grow_plot:[286:301]
                cell_x=length_a/nx
                cell_y=length_a/ny
                for idx1 in range(nx):
                    for idx2 in range(ny):
                        rect_center_x=idx1*cell_x
                        rect_center_y=idx2*cell_y
                        ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                                edgecolor='k', facecolor='none', linewidth=0.5))
                plt.savefig(plot_file, format='pdf')
                plt.close(fig)

        # volume for normalization (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.gg.gg_plot:[357:370]
==phase_field_plot:[296:311]
                cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
                cbar_label=r"Scattering length (b) [$10^{-5} \cdot \mathrm{\AA} = \mathrm{fm}$]"
                cbar.set_label(cbar_label, labelpad=10)
                ## plot title
                title_text=" Cut at Z = {0} {1}".format(z_val_pseudo, r"$\mathrm{\AA}$")
                ax.set_title(title_text)
                # labels
                ax.set_xlabel(r'X [$\mathrm{\AA}$]')
                ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
                # other formatting
                ax.set_aspect('equal')
                ax.set_xlim([0, length_a])
                ax.set_ylim([0, length_b])

                ## add mesh (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.gg.gg_plot:[375:387]
==phase_field_plot:[311:324]
                cell_x=length_a/nx
                cell_y=length_a/ny
                for idx1 in range(nx):
                    for idx2 in range(ny):
                        rect_center_x=idx1*cell_x
                        rect_center_y=idx2*cell_y
                        ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                                edgecolor='k', facecolor='none', linewidth=0.5))
                plt.savefig(plot_file, format='pdf')
                plt.close(fig)

                # plotting categorized pseudo atoms
                ## figure specification (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.gg.gg_plot:[336:349]
==phase_field_plot:[263:281]
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))
            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

            # plotting categorized pseudo atoms
            ## figure specification (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==fs_plot:[366:379]
==models.gg.gg_plot:[322:336]
            cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
            cbar_label=r"Scattering length (b) [$10^{-5} \cdot \mathrm{\AA} = \mathrm{fm}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title
            title_text=" Cut at Z = {0} {1}".format(z_val_pseudo, r"$\mathrm{\AA}$")
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            # other formatting
            ax.set_aspect('equal')
            ax.set_xlim([0, length_a])
            ax.set_ylim([0, length_b])
            ## add mesh (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==fs_plot:[384:396]
==models.gg.gg_plot:[291:307]
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))

            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

            # plotting pseudo atoms
            ## cutting at z = z_val + length_z
            # cell_z= length_c/nz
            # z_val_pseudo=z_val+cell_z (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==fs_plot:[331:345]
==models.box.box_plot:[349:362]
            cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
            cbar_label=r"Scattering length (b) [$10^{-5} \cdot \mathrm{\AA} = \mathrm{fm}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title
            title_text=" Cut at Z = {0} {1}".format(z_val_pseudo, r"$\mathrm{\AA}$")
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            # other formatting
            ax.set_aspect('equal')
            ax.set_xlim([0, length_a])
            ax.set_ylim([0, length_b])
            ## add mesh (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==fs_plot:[345:358]
==models.box.box_plot:[367:379]
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))
            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

    # volume for normalization (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==fs_plot:[300:316]
==models.box.box_plot:[328:341]
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))

            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

            # plotting pseudo atoms
            ## cutting at z = z_val + length_z
            # cell_z= length_c/nz
            # z_val_pseudo=z_val+cell_z (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_plot:[392:405]
==models.box.box_plot:[314:328]
            cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
            cbar_label=r"Scattering length (b) [$10^{-5} \cdot \mathrm{\AA} = \mathrm{fm}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title
            title_text=" Cut at Z = {0} {1}".format(z_val_pseudo, r"$\mathrm{\AA}$")
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            # other formatting
            ax.set_aspect('equal')
            ax.set_xlim([0, length_a])
            ax.set_ylim([0, length_b]) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_plot:[410:422]
==models.box.box_plot:[283:299]
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))

            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

            # plotting pseudo atoms
            ## cutting at z = z_val + length_z
            # cell_z= length_c/nz
            # z_val_pseudo=z_val+cell_z (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_gen:[76:88]
==models.box.box_gen:[71:83]
qclean_sld=0

### scatt_cal ###
num_cat=3
method_cat='extend'
sassena_exe= './Sassena/Sassena.AppImage'
mpi_procs=1
num_threads=1
sig_file='signal.h5'
scan_vec=np.array([1, 0, 0])
Q_range=np.array([0, 1])
num_points=100 (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_plot:[447:465]
==bib_plot:[427:445]
    plot_file=os.path.join(plot_dir,plot_file_name)
    fig, ax = plt.subplots(figsize=(7, 5))

    # loglog plot
    ax.loglog(q, Iq,'r', linestyle='', marker='o', markersize=3, label= 'Numerical calculation')
    ax.loglog(q_ana, Iq_ana, 'gray', label= 'Analytical calculation')

    # plot formatting
    ## legend
    ax.legend()
    ## labels
    ax.set_xlabel(r'Q [$\mathrm{\AA}^{-1}$]')
    ax.set_ylabel(r'I(Q) [$\mathrm{cm}^{-1}$]')
    ## SANS upper boundary Q=1 \AA^-1
    ax.set_xlim(right=1)
    ## save plot
    plt.savefig(plot_file, format='pdf')
    plt.close(fig) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_plot:[371:384]
==bib_plot:[393:405]
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))
            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

            # plotting categorized pseudo atoms
            ## figure specification (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.ball.ball_plot:[164:185]
==sld_grow_plot_joss:[175:196]
data_dir=os.path.join(working_dir, 'data')
mother_dir = os.path.join(data_dir, mother_dir_name)

# read structure info
data_file=os.path.join(mother_dir, 'structure/struct.h5')

# folder name for simulation
sim_dir=os.path.join(mother_dir, 'simulation')

# folder name for model
model_dir_name= (sim_model + '_tend_' + str(t_end) + '_dt_' + str(dt) \
    + '_ensem_' + str(n_ensem)).replace('.','p')
model_dir=os.path.join(sim_dir,model_dir_name)

# folder name for model with particular run param
model_param_dir=os.path.join(model_dir,model_param_dir_name)

# create folder for figure (one level up from data folder)
figure_dir=os.path.join(mother_dir, '../../figure/')
os.makedirs(figure_dir, exist_ok=True)
## folder for this suit of figures (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_plot:[357:371]
==models.ball.ball_plot:[328:341]
            cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
            cbar_label=r"Scattering length (b) [$10^{-5} \cdot \mathrm{\AA} = \mathrm{fm}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title
            title_text=" Cut at Z = {0} {1}".format(z_val_pseudo, r"$\mathrm{\AA}$")
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            # other formatting
            ax.set_aspect('equal')
            ax.set_xlim([0, length_a])
            ax.set_ylim([0, length_b])
            ## add mesh (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_plot:[326:342]
==models.ball.ball_plot:[346:358]
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))
            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

    # ball geometry (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[345:367]
==models.ball.ball_plot:[298:320]
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            # other formatting
            ax.set_aspect('equal')
            ax.set_xlim([0, length_a])
            ax.set_ylim([0, length_b])
            ## add mesh
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))
            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

            # plotting categorized pseudo atoms
            ## figure specification (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[375:388]
==models.ball.ball_plot:[293:307]
            cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
            cbar_label=r"Scattering length (b) [$10^{-5} \cdot \mathrm{\AA} = \mathrm{fm}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title
            title_text=" Cut at Z = {0} {1}".format(z_val_pseudo, r"$\mathrm{\AA}$")
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            # other formatting
            ax.set_aspect('equal')
            ax.set_xlim([0, length_a])
            ax.set_ylim([0, length_b])
            ## add mesh (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[309:325]
==models.ball.ball_plot:[307:320]
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))

            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

            # plotting pseudo atoms
            ## cutting at z = z_val + length_z
            # cell_z= length_c/nz
            # z_val_pseudo=z_val+cell_z (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[354:367]
==models.ball.ball_plot:[263:278]
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))
            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

            # plotting categorized pseudo atoms
            ## figure specification (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_gen:[75:87]
==models.ball.ball_gen:[73:85]
qclean_sld=0

### scatt_cal ###
num_cat=3
method_cat='extend'
sassena_exe= './Sassena/Sassena.AppImage'
mpi_procs=1
num_threads=1
sig_file='signal.h5'
scan_vec=np.array([1, 0, 0])
Q_range=np.array([0., 1.])
num_points=100 (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==scatt_cal:[164:174]
==sim_gen:[137:146]
model_xml=os.path.join(xml_folder, 'model_'+sim_model + '.xml')
tree = ET.parse(model_xml)
root = tree.getroot()
model_param_dir_name=''
for elem in root.iter():
    if elem.text and elem.text.strip():  # Avoid None or empty texts
        model_param_dir_name+= f"{elem.tag}_{elem.text.strip()}_"
model_param_dir_name=model_param_dir_name[0:-1].replace('.', 'p')
model_param_dir=os.path.join(model_dir,model_param_dir_name)
 (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==sld_grow_plot:[458:470]
==sld_grow_plot_joss:[247:261]
    ax_scatt_all.loglog(q_ana, Iq_ana,
                         color=color_rainbow[i],
                           zorder=len(t_arr)+i,
                             label= f'Ana (t = {t} s)')
    ax_scatt_all.loglog(q_num, Iq_num,
                         color=color_rainbow[i],
                           zorder=i, linestyle='',
                             marker='o', markersize=3,
                               label= f'Num (t = {t} s)')

# plot formatting
## legend
# ax_scatt_all.legend(ncol=2)
## labels (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==fs_plot:[492:509]
==models.gg.gg_plot:[457:474]
    ax.grid(True)
    ## save plot
    plt.savefig(plot_file, format='pdf')
    plt.close(fig)

    # plot scatt patern for all time steps
    ax_scatt_all.loglog(q_ana, Iq_ana, color=color_rainbow[i], label= f'Ana (t = {t} s)')
    ax_scatt_all.loglog(q_num, Iq_num, color=color_rainbow[i], linestyle='',
                         marker='o', markersize=3, label= f'Num (t = {t} s)')

# plot formatting
## legend
ax_scatt_all.legend(ncol=2)
## labels
ax_scatt_all.set_xlabel(r'Q [$\mathrm{\AA}^{-1}$]')
ax_scatt_all.set_ylabel(r'I(Q) [$\mathrm{cm}^{-1}$]')
## SANS upper boundary Q=1 \AA^-1 (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.box.box_plot:[342:386]
==models.gg.gg_plot:[350:394]
            plot_file=os.path.join(plot_dir,plot_file_name)
            fig, ax = plt.subplots(figsize=(5, 5))
            ## scatter plot
            pseudo_b_cat_val_3d=pseudo_b_cat_val.reshape((nx, ny, nz))
            pseudo_b_cat_val_xy=pseudo_b_cat_val_3d[:,:,z_idx_pseudo]
            img = ax.scatter(pseudo_pos_x, pseudo_pos_y, c=pseudo_b_cat_val_xy, s=3, cmap='viridis')
            ## color bar
            cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
            cbar_label=r"Scattering length (b) [$10^{-5} \cdot \mathrm{\AA} = \mathrm{fm}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title
            title_text=" Cut at Z = {0} {1}".format(z_val_pseudo, r"$\mathrm{\AA}$")
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            # other formatting
            ax.set_aspect('equal')
            ax.set_xlim([0, length_a])
            ax.set_ylim([0, length_b])
            x_ticks_val=np.round(np.linspace(0, length_a, 5),2)
            ax.set_xticks(list(x_ticks_val))
            y_ticks_val=np.round(np.linspace(0, length_b, 5),2)
            ax.set_yticks(list(y_ticks_val))
            ## add mesh
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))
            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

    # volume for normalization
    vol_norm=length_a*length_b*length_c # volume of box

    # numerical intensity
    ## read I vs Q signal file
    Iq_data_file_name=f'Iq_{scatt_settings}.h5'
    Iq_data_file=os.path.join(t_dir,Iq_data_file_name)
    Iq_data=h5py.File(Iq_data_file,'r') (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_plot:[385:422]
==sld_grow_plot:[344:380]
            plot_file=os.path.join(plot_dir,plot_file_name)
            fig, ax = plt.subplots(figsize=(5, 5))
            ## scatter plot
            pseudo_b_cat_val_3d=pseudo_b_cat_val.reshape((nx, ny, nz))
            pseudo_b_cat_val_xy=pseudo_b_cat_val_3d[:,:,z_idx_pseudo]
            img = ax.scatter(pseudo_pos_x, pseudo_pos_y, c=pseudo_b_cat_val_xy, s=3, cmap='viridis')
            ## color bar
            cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
            cbar_label=r"Scattering length (b) [$10^{-5} \cdot \mathrm{\AA} = \mathrm{fm}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title
            title_text=" Cut at Z = {0} {1}".format(z_val_pseudo, r"$\mathrm{\AA}$")
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            # other formatting
            ax.set_aspect('equal')
            ax.set_xlim([0, length_a])
            ax.set_ylim([0, length_b])
            x_ticks_val=np.round(np.linspace(0, length_a, 5),2)
            ax.set_xticks(list(x_ticks_val))
            y_ticks_val=np.round(np.linspace(0, length_b, 5),2)
            ax.set_yticks(list(y_ticks_val))
            ## add mesh
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))
            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

    # volume for normalization (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_plot:[385:429]
==fs_plot:[359:403]
            plot_file=os.path.join(plot_dir,plot_file_name)
            fig, ax = plt.subplots(figsize=(5, 5))
            ## scatter plot
            pseudo_b_cat_val_3d=pseudo_b_cat_val.reshape((nx, ny, nz))
            pseudo_b_cat_val_xy=pseudo_b_cat_val_3d[:,:,z_idx_pseudo]
            img = ax.scatter(pseudo_pos_x, pseudo_pos_y, c=pseudo_b_cat_val_xy, s=3, cmap='viridis')
            ## color bar
            cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
            cbar_label=r"Scattering length (b) [$10^{-5} \cdot \mathrm{\AA} = \mathrm{fm}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title
            title_text=" Cut at Z = {0} {1}".format(z_val_pseudo, r"$\mathrm{\AA}$")
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            # other formatting
            ax.set_aspect('equal')
            ax.set_xlim([0, length_a])
            ax.set_ylim([0, length_b])
            x_ticks_val=np.round(np.linspace(0, length_a, 5),2)
            ax.set_xticks(list(x_ticks_val))
            y_ticks_val=np.round(np.linspace(0, length_b, 5),2)
            ax.set_yticks(list(y_ticks_val))
            ## add mesh
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))
            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

    # volume for normalization
    vol_norm=length_a*length_b*length_c # sim box volumr

    # numerical intensity
    ## read I vs Q signal file
    Iq_data_file_name=f'Iq_{scatt_settings}.h5'
    Iq_data_file=os.path.join(t_dir,Iq_data_file_name)
    Iq_data=h5py.File(Iq_data_file,'r') (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[368:419]
==models.box.box_plot:[342:393]
            plot_file=os.path.join(plot_dir,plot_file_name)
            fig, ax = plt.subplots(figsize=(5, 5))
            ## scatter plot
            pseudo_b_cat_val_3d=pseudo_b_cat_val.reshape((nx, ny, nz))
            pseudo_b_cat_val_xy=pseudo_b_cat_val_3d[:,:,z_idx_pseudo]
            img = ax.scatter(pseudo_pos_x, pseudo_pos_y, c=pseudo_b_cat_val_xy, s=3, cmap='viridis')
            ## color bar
            cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
            cbar_label=r"Scattering length (b) [$10^{-5} \cdot \mathrm{\AA} = \mathrm{fm}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title
            title_text=" Cut at Z = {0} {1}".format(z_val_pseudo, r"$\mathrm{\AA}$")
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            # other formatting
            ax.set_aspect('equal')
            ax.set_xlim([0, length_a])
            ax.set_ylim([0, length_b])
            x_ticks_val=np.round(np.linspace(0, length_a, 5),2)
            ax.set_xticks(list(x_ticks_val))
            y_ticks_val=np.round(np.linspace(0, length_b, 5),2)
            ax.set_yticks(list(y_ticks_val))
            ## add mesh
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))
            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

    # volume for normalization
    vol_norm=length_a*length_b*length_c # volume of box

    # numerical intensity
    ## read I vs Q signal file
    Iq_data_file_name=f'Iq_{scatt_settings}.h5'
    Iq_data_file=os.path.join(t_dir,Iq_data_file_name)
    Iq_data=h5py.File(Iq_data_file,'r')
    Iq=Iq_data['Iq'][:] # unit fm^2
    Iq=Iq/vol_norm*10**2 # unit (fm^2 / \AA^3) * 10^2 = cm^-1
    q=Iq_data['Q'][:]
    Iq_data.close()

    # ananlytical intensity
    ## Intensity unit 10^-10 \AA^2 (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_gen:[78:87]
==models.gg.gg_gen:[78:87]
num_cat=3
method_cat='extend'
sassena_exe= './Sassena/Sassena.AppImage'
mpi_procs=1
num_threads=1
sig_file='signal.h5'
scan_vec=np.array([1, 0, 0])
Q_range=np.array([0., 1.])
num_points=100 (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.ball.ball_plot:[294:307]
==phase_field_plot:[334:346]
            cbar_label=r"Scattering length (b) [$10^{-5} \cdot \mathrm{\AA} = \mathrm{fm}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title
            title_text=" Cut at Z = {0} {1}".format(z_val_pseudo, r"$\mathrm{\AA}$")
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            # other formatting
            ax.set_aspect('equal')
            ax.set_xlim([0, length_a])
            ax.set_ylim([0, length_b])
            ## add mesh (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[368:405]
==models.ball.ball_plot:[321:358]
            plot_file=os.path.join(plot_dir,plot_file_name)
            fig, ax = plt.subplots(figsize=(5, 5))
            ## scatter plot
            pseudo_b_cat_val_3d=pseudo_b_cat_val.reshape((nx, ny, nz))
            pseudo_b_cat_val_xy=pseudo_b_cat_val_3d[:,:,z_idx_pseudo]
            img = ax.scatter(pseudo_pos_x, pseudo_pos_y, c=pseudo_b_cat_val_xy, s=3, cmap='viridis')
            ## color bar
            cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
            cbar_label=r"Scattering length (b) [$10^{-5} \cdot \mathrm{\AA} = \mathrm{fm}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title
            title_text=" Cut at Z = {0} {1}".format(z_val_pseudo, r"$\mathrm{\AA}$")
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            # other formatting
            ax.set_aspect('equal')
            ax.set_xlim([0, length_a])
            ax.set_ylim([0, length_b])
            x_ticks_val=np.round(np.linspace(0, length_a, 5),2)
            ax.set_xticks(list(x_ticks_val))
            y_ticks_val=np.round(np.linspace(0, length_b, 5),2)
            ax.set_yticks(list(y_ticks_val))
            ## add mesh
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))
            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

    # volume for normalization (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[332:344]
==models.ball.ball_plot:[285:297]
            plot_file=os.path.join(plot_dir,plot_file_name)
            fig, ax = plt.subplots(figsize=(5, 5))
            ## scatter plot
            pseudo_pos_x=pseudo_pos_3d[:,:,z_idx_pseudo,0]
            pseudo_pos_y=pseudo_pos_3d[:,:,z_idx_pseudo,1]
            pseudo_b_xy=pseudo_b_3d[:,:,z_idx_pseudo]
            img = ax.scatter(pseudo_pos_x, pseudo_pos_y, c=pseudo_b_xy, s=3, cmap='viridis')
            ## color bar
            cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
            cbar_label=r"Scattering length (b) [$10^{-5} \cdot \mathrm{\AA} = \mathrm{fm}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.ball.ball_gen:[72:83]
==models.box.box_gen:[70:81]
sld=2
qclean_sld=0

### scatt cal ###
num_cat=3
method_cat='extend'
sassena_exe= './Sassena/Sassena.AppImage'
mpi_procs=1
num_threads=1
sig_file='signal.h5'
scan_vec=np.array([1, 0, 0]) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==sld_grow_gen:[53:61]
==sld_grow_plot:[101:112]
length_a=40.
length_b=length_a
length_c=length_a
# number of cells in each direction (int values)
nx=40
ny=nx
nz=nx
# element details
el_type='lagrangian'
el_order=1
# calculate mid point of structure (simulation box) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==fs_gen:[55:65]
==sld_grow_gen:[57:67]
ny=nx
nz=nx
el_type='lagrangian'
el_order=1
update_val=True
plt_node=False
plt_cell=False
plt_mesh=False

### sim gen ### (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==fs_gen:[51:59]
==fs_plot:[108:119]
length_a=200.
length_b=length_a
length_c=length_a
# number of cells in each direction (int values)
nx=100
ny=nx
nz=nx
# element details
el_type='lagrangian'
el_order=1
# calculate mid point of structure (simulation box) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.box.box_gen:[50:58]
==models.gg.gg_plot:[104:115]
length_a=40.
length_b=40.
length_c=40.
nx=40
ny=40
nz=40
el_type='lagrangian'
el_order=1 (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_plot:[33:58]
==models.gg.gg_plot:[34:59]
lib_dir = os.path.abspath(os.path.join(os.path.dirname(__file__), '../..'))
# add .. in path
sys.path.append(lib_dir)
# lib imports (if any)

# ignore warnings
warnings.filterwarnings("ignore")

# analytical SAS function
def J1(x):
    """
    function desc:
    spherical bessel function
    """
    if x==0:
        y= 0
    else:
        y = (np.sin(x)-x*np.cos(x))/x**2
    return y

def arrange_order(a,b,c):
    """
    function desc:
    sort values
    """ (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_gen:[52:60]
==models.box.box_plot:[110:121]
length_a=40.
length_b=40.
length_c=40.
# number of cells in each direction (int values)
nx=40
ny=40
nz=40
# element details
el_type='lagrangian'
el_order=1
# calculate mid point of structure (simulation box) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[195:208]
==phase_field_plot:[146:160]
    length_a_str=str(length_a).replace('.','p')
    length_b_str=str(length_a).replace('.','p')
    length_c_str=str(length_a).replace('.','p')

    ### save num_cell values as strings
    nx_str=str(nx)
    ny_str=str(ny)
    nz_str=str(nz)

    ### save element_order values as strings
    el_order_str='lagrangian_' + str(el_order)


    mother_dir_name = length_a_str+'_' + length_b_str+'_' + length_c_str\ (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[33:58]
==fs_plot:[34:59]
lib_dir = os.path.abspath(os.path.join(os.path.dirname(__file__), '../..'))
# add .. in path
sys.path.append(lib_dir)
# lib imports (if any)

# ignore warnings
warnings.filterwarnings("ignore")

# analytical SAS function
def J1(x):
    """
    function desc:
    spherical bessel function
    """
    if x==0:
        y= 0
    else:
        y = (np.sin(x)-x*np.cos(x))/x**2
    return y

def arrange_order(a,b,c):
    """
    function desc:
    sort values
    """ (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_plot:[357:371]
==bib_plot:[375:388]
            cbar = plt.colorbar(img, ax=ax)  # Add colorbar to subplot 1
            cbar_label=r"Scattering length (b) [$10^{-5} \cdot \mathrm{\AA} = \mathrm{fm}$]"
            cbar.set_label(cbar_label, labelpad=10)
            ## plot title
            title_text=" Cut at Z = {0} {1}".format(z_val_pseudo, r"$\mathrm{\AA}$")
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            # other formatting
            ax.set_aspect('equal')
            ax.set_xlim([0, length_a])
            ax.set_ylim([0, length_b])
            ## add mesh (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_gen:[75:85]
==models.box.box_gen:[71:81]
qclean_sld=0

### scatt cal ###
num_cat=3
method_cat='extend'
sassena_exe= './Sassena/Sassena.AppImage'
mpi_procs=1
num_threads=1
sig_file='signal.h5'
scan_vec=np.array([1, 0, 0]) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_plot:[150:161]
==bib_gen:[52:60]
length_a=40.
length_b=40.
length_c=40.
nx=40
ny=40
nz=40
el_type='lagrangian'
el_order=1 (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_gen:[76:86]
==models.ball.ball_gen:[73:83]
qclean_sld=0

### scatt_cal ###
num_cat=3
method_cat='extend'
sassena_exe= './Sassena/Sassena.AppImage'
mpi_procs=1
num_threads=1
sig_file='signal.h5'
scan_vec=np.array([1, 0, 0]) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[136:147]
==models.ball.ball_gen:[51:59]
length_a=40.
length_b=40.
length_c=40.
nx=40
ny=40
nz=40
el_type='lagrangian'
el_order=1 (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==figure_sas:[41:59]
==figure_sig_eff:[40:53]
    if cols == 1:
        axes = [axes]

    for ax, img in zip(axes, images):
        ax.imshow(img)
        ax.axis('off')

    fig.tight_layout()
    fig.savefig(output_image, dpi=dpi)
    plt.close(fig)

# Example usage
# mother dir (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==sig_eff_cal:[177:184]
==sim_gen:[137:144]
model_xml=os.path.join(xml_folder, 'model_'+sim_model + '.xml')
tree = ET.parse(model_xml)
root = tree.getroot()
model_param_dir_name=''
for elem in root.iter():
    if elem.text and elem.text.strip():  # Avoid None or empty texts
        model_param_dir_name+= f"{elem.tag}_{elem.text.strip()}_" (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.gg.gg_plot:[391:400]
==sld_grow_plot_joss:[225:234]
    Iq_data_file_name=f'Iq_{scatt_settings}.h5'
    Iq_data_file=os.path.join(t_dir,Iq_data_file_name)
    Iq_data=h5py.File(Iq_data_file,'r')
    Iq_num_raw=Iq_data['Iq'][:] # unit fm^2
    Iq_num=Iq_num_raw/vol_norm*10**2 # unit (fm^2 / \AA^3) * 10^2 = cm^-1
    q_num=Iq_data['Q'][:]
    Iq_data.close()

    # fit radius w.r.t. numerical intensity (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==fs_plot:[400:410]
==sld_grow_plot:[387:396]
    Iq_data_file_name=f'Iq_{scatt_settings}.h5'
    Iq_data_file=os.path.join(t_dir,Iq_data_file_name)
    Iq_data=h5py.File(Iq_data_file,'r')
    Iq_num_raw=Iq_data['Iq'][:] # unit fm^2
    Iq_num=Iq_num_raw/vol_norm*10**2 # unit (fm^2 / \AA^3) * 10^2 = cm^-1
    q_num=Iq_data['Q'][:]
    Iq_data.close()

    # fit radius w.r.t. numerical intensity (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==fs_gen:[79:86]
==phase_field_gen:[103:110]
num_cat=501
method_cat='extend'
sassena_exe= './Sassena/Sassena.AppImage'
mpi_procs=1
num_threads=1
sig_file='signal.h5'
scan_vec=np.array([1, 0, 0]) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_gen:[79:86]
==models.gg.gg_gen:[78:85]
num_cat=3
method_cat='extend'
sassena_exe= './Sassena/Sassena.AppImage'
mpi_procs=1
num_threads=1
sig_file='signal.h5'
scan_vec=np.array([1, 0, 0]) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[170:181]
==models.gg.gg_plot:[141:152]
                             ).replace('.', 'p')

### scatt cal ###
# decreitization params
# number of categories and method of categorization
num_cat=3
method_cat='extend'
sig_file='signal.h5'
scan_vec=np.array([1, 0, 0])
Q_range=np.array([0., 1.]) # mention integers as float
num_points=100 (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_plot:[166:177]
==bib_plot:[153:164]
dt=1.
t_end=0.
n_ensem=1
# calculate time array
t_arr=np.arange(0,t_end+dt, dt)

### model param ###
# model params
ball_rad=10
sld_in=2
sld_out=1 (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.ball.ball_plot:[138:159]
==scatt_cal:[125:143]
scatt_settings=scatt_settings.replace('.', 'p')

######################################################
# create folder structure, read structure and sld info
######################################################

# folder structure
## mother folder for simulation
### save length values as strings
### decimal points are replaced with p
length_a_str=str(length_a).replace('.','p')
length_b_str=str(length_a).replace('.','p')
length_c_str=str(length_a).replace('.','p')

### save num_cell values as strings
nx_str=str(nx)
ny_str=str(ny)
nz_str=str(nz) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==fs_plot:[61:72]
==models.ball.ball_plot:[60:69]
    del_rho=sld-sld_sol
    q_arr=np.linspace(qmin,qmax,Npts)
    FormFactor=np.zeros(len(q_arr))
    for q_idx, q_cur in enumerate(q_arr):
        if q_cur==0:
            # Form factor unit 10^-5 \AA
            FormFactor[q_idx]=vol*del_rho
        else:
            # Form factor unit 10^-5 \AA (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[409:419]
==models.ball.ball_plot:[365:375]
    Iq_data_file_name=f'Iq_{scatt_settings}.h5'
    Iq_data_file=os.path.join(t_dir,Iq_data_file_name)
    Iq_data=h5py.File(Iq_data_file,'r')
    Iq=Iq_data['Iq'][:] # unit fm^2
    Iq=Iq/vol_norm*10**2 # unit (fm^2 / \AA^3) * 10^2 = cm^-1
    q=Iq_data['Q'][:]
    Iq_data.close()

    # ananlytical intensity
    ## Intensity unit 10^-10 \AA^2 (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.ball.ball_gen:[31:52]
==sld_grow_gen:[33:54]
lib_dir = os.path.abspath(os.path.join(os.path.dirname(__file__), '../..'))
# add .. in path
sys.path.append(lib_dir)
# lib imports
from lib import xml_gen # pylint: disable=wrong-import-position

# ignore warnings

warnings.filterwarnings("ignore")

##############
# input values
##############
# script dir and working dir
script_dir = "src"  # Full path of the script
working_dir = "."  # Directory to run the script in


### struct gen ###
xml_dir='./xml'
length_a=40. (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==phase_field_plot:[146:156]
==scatt_cal:[135:143]
length_a_str=str(length_a).replace('.','p')
length_b_str=str(length_a).replace('.','p')
length_c_str=str(length_a).replace('.','p')

### save num_cell values as strings
nx_str=str(nx)
ny_str=str(ny)
nz_str=str(nz) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==fs_gen:[71:79]
==fs_plot:[133:140]
rad=60
sig_0=2
sig_end=10
sld_in=5
sld_out=1
qclean_sld=sld_out
# dir name for model param (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_plot:[211:221]
==struct_gen:[89:98]
length_a_str=str(length_a).replace('.','p')
length_b_str=str(length_a).replace('.','p')
length_c_str=str(length_a).replace('.','p')

# save num_cell values as strings
nx_str=str(nx)
ny_str=str(ny)
nz_str=str(nz)
 (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_plot:[456:465]
==models.box.box_plot:[410:419]
    ax.legend()
    ## labels
    ax.set_xlabel(r'Q [$\mathrm{\AA}^{-1}$]')
    ax.set_ylabel(r'I(Q) [$\mathrm{cm}^{-1}$]')
    ## SANS upper boundary Q=1 \AA^-1
    ax.set_xlim(right=1)
    ## save plot
    plt.savefig(plot_file, format='pdf')
    plt.close(fig) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_gen:[80:86]
==sld_grow_gen:[81:89]
method_cat='extend'
sassena_exe= './Sassena/Sassena.AppImage'
mpi_procs=1
num_threads=1
sig_file='signal.h5'
scan_vec=np.array([1, 0, 0]) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_gen:[58:66]
==sld_grow_gen:[59:67]
el_type='lagrangian'
el_order=1
update_val=True
plt_node=False
plt_cell=False
plt_mesh=False

### sim gen ### (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[195:205]
==sim_gen:[104:113]
length_a_str=str(length_a).replace('.','p')
length_b_str=str(length_a).replace('.','p')
length_c_str=str(length_a).replace('.','p')

### save num_cell values as strings
nx_str=str(nx)
ny_str=str(ny)
nz_str=str(nz)

### save element_order values as strings (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_plot:[191:197]
==bib_plot:[175:181]
num_cat=3
method_cat='extend'
sig_file='signal.h5'
scan_vec=np.array([1, 0, 0])
Q_range=np.array([0., 1.]) # mention integers as float
num_points=100 (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_gen:[79:85]
==phase_field_gen:[104:110]
method_cat='extend'
sassena_exe= './Sassena/Sassena.AppImage'
mpi_procs=1
num_threads=1
sig_file='signal.h5'
scan_vec=np.array([1, 0, 0]) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_gen:[58:66]
==phase_field_gen:[84:92]
    el_type='lagrangian'
    el_order=1
    update_val=True
    plt_node=False
    plt_cell=False
    plt_mesh=False

    ### sim_gen ### (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_ecc_gen:[67:75]
==bib_gen:[67:75]
dt=1
t_end=0
n_ensem=1

### model_param ###
rad=10
sld_in=2
sld_out=1 (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.ball.ball_plot:[149:159]
==sig_eff_cal:[144:152]
length_a_str=str(length_a).replace('.','p')
length_b_str=str(length_a).replace('.','p')
length_c_str=str(length_a).replace('.','p')

### save num_cell values as strings
nx_str=str(nx)
ny_str=str(ny)
nz_str=str(nz)

### save element_order values as strings (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[436:445]
==models.ball.ball_plot:[391:400]
    ax.legend()
    ## labels
    ax.set_xlabel(r'Q [$\mathrm{\AA}^{-1}$]')
    ax.set_ylabel(r'I(Q) [$\mathrm{cm}^{-1}$]')
    ## SANS upper boundary Q=1 \AA^-1
    ax.set_xlim(right=1)
    ## save plot
    plt.savefig(plot_file, format='pdf')
    plt.close(fig) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[345:354]
==models.ball.ball_plot:[333:341]
            ax.set_title(title_text)
            # labels
            ax.set_xlabel(r'X [$\mathrm{\AA}$]')
            ax.set_ylabel(r'Y [$\mathrm{\AA}$]')
            # other formatting
            ax.set_aspect('equal')
            ax.set_xlim([0, length_a])
            ax.set_ylim([0, length_b]) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==fs_gen:[80:86]
==models.ball.ball_gen:[77:83]
method_cat='extend'
sassena_exe= './Sassena/Sassena.AppImage'
mpi_procs=1
num_threads=1
sig_file='signal.h5'
scan_vec=np.array([1, 0, 0]) (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==fs_gen:[57:65]
==models.ball.ball_gen:[57:65]
el_type='lagrangian'
el_order=1
update_val=True
plt_node=False
plt_cell=False
plt_mesh=False

### sim gen ### (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==fs_gen:[31:51]
==models.ball.ball_gen:[31:51]
lib_dir = os.path.abspath(os.path.join(os.path.dirname(__file__), '../..'))
# add .. in path
sys.path.append(lib_dir)
# lib imports
from lib import xml_gen # pylint: disable=wrong-import-position

# ignore warnings
warnings.filterwarnings("ignore")

##############
# input values
##############

# script dir and working dir
script_dir = "src"  # Full path of the script
working_dir = "."  # Directory to run the script in


### struct gen ###
xml_dir='./xml' (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==scatt_cal:[69:77]
==struct_gen:[62:71]
el_type=root.find('element').find('type').text
if el_type=='lagrangian':
    el_order=int(root.find('element').find('order').text)
    el_info={'type': el_type,
             'order': el_order}

### sim xml ###
 (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==sld_grow_gen:[85:97]
==sld_grow_plot:[144:152]
sig_file='signal.h5'
scan_vec=np.array([1, 0, 0])
# these values are taken from publication
# doi: https://doi.org/10.3233/JNR-190116
Q_range=np.array([0.0029, 0.05])
num_points=100
num_orientation=10
# scatt settengs (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==phase_field_gen:[108:115]
==phase_field_plot:[125:131]
    sig_file='signal.h5'
    scan_vec=np.array([1, 0, 0])
    Q_range=np.array([2*np.pi/length_a, 1])
    num_points=100
    num_orientation=200

    ### run_vars ### (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==phase_field_gen:[81:86]
==phase_field_plot:[92:99]
    nx=moose_inp['nx'][()]
    ny=moose_inp['ny'][()]
    nz=moose_inp['ny'][()]
    el_type='lagrangian'
    el_order=1 (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.gg.gg_plot:[422:432]
==sld_grow_plot:[417:427]
               marker='o', markersize=3,
                 label= 'Numerical calculation')

    # plot formatting
    ## legend
    ax.legend()
    ## labels
    ax.set_xlabel(r'Q [$\mathrm{\AA}^{-1}$]')
    ax.set_ylabel(r'I(Q) [$\mathrm{cm}^{-1}$]')
    ## SANS upper boundary Q=1 \AA^-1 (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.gg.gg_plot:[85:105]
==sld_grow_plot:[86:102]
    return Iq

############
# Input data
############
### file locations ###
# xml location
xml_folder='./xml/'
# script dir and working dir
script_dir = "src"  # Full path of the script
working_dir = "."  # Directory to run the script in


### struct gen ###
# box side lengths (float values)
length_a=40. (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.gg.gg_gen:[83:90]
==models.gg.gg_plot:[148:154]
sig_file='signal.h5'
scan_vec=np.array([1, 0, 0])
Q_range=np.array([0., 1.])
num_points=100
num_orientation=10

### run vars ### (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.gg.gg_gen:[71:78]
==models.gg.gg_plot:[130:136]
rad_0=7
rad_end=17
sld_in=2
sld_out=1
qclean_sld=sld_out

### scatt cal ### (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==fs_plot:[426:435]
==sld_grow_plot:[406:415]
    Iq_ana = (Iq_ana_raw / vol_norm) * 10**2

    # plot scatt pattern for this time step
    plot_file_name=f'Iq_{sim_model}_{t_str}.pdf'
    plot_file=os.path.join(plot_dir,plot_file_name)
    fig, ax = plt.subplots(figsize=(7, 5))

    # loglog plot
    ax.loglog(q_ana, Iq_ana, 'b', label= 'Analytical calculation') (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==fs_plot:[113:123]
==sld_grow_plot:[106:117]
ny=nx
nz=nx
# element details
el_type='lagrangian'
el_order=1
# calculate mid point of structure (simulation box)
mid_point=np.array([length_a/2, length_b/2, length_c/2])


### sim gen ###
# model name (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==fs_plot:[382:403]
==phase_field_plot:[355:376]
            ax.set_yticks(list(y_ticks_val))
            ## add mesh
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))
            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

    # volume for normalization
    vol_norm=length_a*length_b*length_c # sim box volumr

    # numerical intensity
    ## read I vs Q signal file
    Iq_data_file_name=f'Iq_{scatt_settings}.h5'
    Iq_data_file=os.path.join(t_dir,Iq_data_file_name)
    Iq_data=h5py.File(Iq_data_file,'r') (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==fs_plot:[470:479]
==models.gg.gg_plot:[434:443]
    plt.savefig(plot_file, format='pdf')
    plt.close(fig)

    # plot fit param upto this time step
    plot_file_name=f'rad_fit_{sim_model}_{t_str}.pdf'
    plot_file=os.path.join(plot_dir,plot_file_name)
    fig, ax = plt.subplots(figsize=(7, 5))

    # plot (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[391:419]
==phase_field_plot:[355:382]
            ax.set_yticks(list(y_ticks_val))
            ## add mesh
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))
            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

    # volume for normalization
    vol_norm=length_a*length_b*length_c # box volume for normalization

    # numerical intensity
    ## read I vs Q signal file
    Iq_data_file_name=f'Iq_{scatt_settings}.h5'
    Iq_data_file=os.path.join(t_dir,Iq_data_file_name)
    Iq_data=h5py.File(Iq_data_file,'r')
    Iq=Iq_data['Iq'][:] # unit fm^2
    Iq=Iq/vol_norm*10**2 # unit (fm^2 / \AA^3) * 10^2 = cm^-1
    q=Iq_data['Q'][:]
    Iq_data.close()

    # ananlytical intensity
    ## Intensity unit 10^-10 \AA^2 (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[180:195]
==phase_field_plot:[128:136]
    num_points=100
    num_orientation=200
    # scatt settengs
    scatt_settings='cat_' + method_cat + '_' + str(num_cat) + 'Q_' \
        + str(Q_range[0]) + '_' + str(Q_range[1]) + '_' + 'orien__' + str(num_orientation)
    scatt_settings=scatt_settings.replace('.', 'p')

    # close moose input file (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_gen:[83:90]
==bib_plot:[177:183]
sig_file='signal.h5'
scan_vec=np.array([1, 0, 0])
Q_range=np.array([0., 1.]) # mention integers as float
num_points=100
num_orientation=200
# scatt settengs (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.ball.ball_plot:[344:358]
==phase_field_plot:[355:369]
            ax.set_yticks(list(y_ticks_val))
            ## add mesh
            cell_x=length_a/nx
            cell_y=length_a/ny
            for idx1 in range(nx):
                for idx2 in range(ny):
                    rect_center_x=idx1*cell_x
                    rect_center_y=idx2*cell_y
                    ax.add_patch(Rectangle((rect_center_x, rect_center_y), cell_x, cell_y,
                                            edgecolor='k', facecolor='none', linewidth=0.5))
            plt.savefig(plot_file, format='pdf')
            plt.close(fig)

    # ball geometry (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==fs_plot:[280:288]
==models.ball.ball_plot:[242:250]
            plot_file=os.path.join(plot_dir,plot_file_name)
            fig, ax = plt.subplots(figsize=(5, 5))
            ## image plot
            ### .T is required to exchange x and y axis
            ### origin is 'lower' to put it in lower left corner
            node_sld_3d=node_sld.reshape((num_node_x, num_node_y, num_node_z))
            img = ax.imshow(node_sld_3d[:,:,z_idx].T,
                             extent=[0, length_a, 0, length_b], (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==bib_plot:[176:181]
==models.ball.ball_plot:[128:134]
method_cat='extend'
sig_file='signal.h5'
scan_vec=np.array([1, 0, 0])
Q_range=np.array([0., 1.]) # mention integers as float
num_points=100 (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.ball.ball_gen:[176:183]
==sld_grow_gen:[218:225]
print('-------------------------------------------------')

# Time satistics
print('')
print('-------------------------------------------------')
print('Time statistics')
print('-------------------------------------------------') (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.ball.ball_gen:[31:50]
==phase_field_gen:[33:51]
lib_dir = os.path.abspath(os.path.join(os.path.dirname(__file__), '../..'))
# add .. in path
sys.path.append(lib_dir)
# lib imports
from lib import xml_gen # pylint: disable=wrong-import-position


# ignore warnings
warnings.filterwarnings("ignore")

##############
# input values
##############
# script dir and working dir
script_dir = "src"  # Full path of the script
working_dir = "."  # Directory to run the script in


### struct gen ### (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==models.ball.ball_gen:[81:88]
==models.ball.ball_plot:[130:136]
sig_file='signal.h5'
scan_vec=np.array([1, 0, 0])
Q_range=np.array([0., 1.])
num_points=100
num_orientation=10
# scatt settengs (duplicate-code)
tests/test_sld_grow.py:1:0: R0801: Similar lines in 2 files
==figure_sas:[33:39]
==figure_sig_eff:[32:38]
    images = []
    for path in pdf_paths:
        pages = convert_from_path(path, dpi=dpi)
        images.append(pages[0])  # use first page only

    cols = len(images) (duplicate-code)

------------------------------------------------------------------
Your code has been rated at 9.17/10 (previous run: 9.17/10, +0.00)

